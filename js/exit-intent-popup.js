class ExitIntentPopup{constructor(){this.config={delay:0,cookieName:"tpp_exit_popup_shown",cookieExpiry:7,mobileDelay:15e3,minTimeOnPage:5e3,scrollThreshold:30},this.analytics={shown:0,closed:0,converted:0},this.init()}init(){this.shouldShowPopup()&&(this.createPopupHTML(),this.attachEventListeners(),this.trackPageTime())}shouldShowPopup(){if(this.getCookie(this.config.cookieName))return!1;return!["/thank-you","/privacy","/terms","/disclaimer"].some((n=>window.location.pathname.includes(n)))}createPopupHTML(){document.head.insertAdjacentHTML("beforeend","\n            <style>\n                .exit-popup-overlay {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0, 0, 0, 0.7);\n                    backdrop-filter: blur(4px);\n                    z-index: 999999;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    animation: fadeIn 0.3s ease-out;\n                }\n\n                @keyframes fadeIn {\n                    from { opacity: 0; }\n                    to { opacity: 1; }\n                }\n\n                @keyframes slideUp {\n                    from {\n                        opacity: 0;\n                        transform: translateY(30px) scale(0.95);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: translateY(0) scale(1);\n                    }\n                }\n\n                .exit-popup-container {\n                    background: white;\n                    border-radius: 20px;\n                    max-width: 500px;\n                    width: 90%;\n                    max-height: 90vh;\n                    overflow-y: auto;\n                    position: relative;\n                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n                    animation: slideUp 0.4s ease-out;\n                }\n\n                .exit-popup-close {\n                    position: absolute;\n                    top: 20px;\n                    right: 20px;\n                    background: white;\n                    border: 2px solid #e5e7eb;\n                    border-radius: 50%;\n                    width: 40px;\n                    height: 40px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                    z-index: 10;\n                }\n\n                .exit-popup-close:hover {\n                    background: #f3f4f6;\n                    transform: rotate(90deg);\n                }\n\n                .exit-popup-content {\n                    padding: 40px 30px 30px;\n                    text-align: center;\n                }\n\n                .exit-popup-badge {\n                    display: inline-block;\n                    background: linear-gradient(135deg, #ef4444, #dc2626);\n                    color: white;\n                    padding: 6px 16px;\n                    border-radius: 20px;\n                    font-size: 12px;\n                    font-weight: 700;\n                    letter-spacing: 1px;\n                    margin-bottom: 20px;\n                    animation: pulse 2s infinite;\n                }\n\n                @keyframes pulse {\n                    0%, 100% { transform: scale(1); }\n                    50% { transform: scale(1.05); }\n                }\n\n                .exit-popup-title {\n                    font-size: 28px;\n                    font-weight: 800;\n                    margin: 0 0 20px;\n                    color: #111827;\n                    line-height: 1.2;\n                }\n\n                .exit-popup-value {\n                    display: inline-flex;\n                    align-items: baseline;\n                    gap: 8px;\n                    margin-bottom: 15px;\n                    padding: 10px 20px;\n                    background: linear-gradient(135deg, #fef3c7, #fde68a);\n                    border-radius: 10px;\n                }\n\n                .value-amount {\n                    font-size: 36px;\n                    font-weight: 900;\n                    color: #f59e0b;\n                    text-decoration: line-through;\n                }\n\n                .value-label {\n                    font-size: 14px;\n                    font-weight: 700;\n                    color: #92400e;\n                }\n\n                .exit-popup-subtitle {\n                    font-size: 20px;\n                    font-weight: 700;\n                    margin: 0 0 25px;\n                    color: #059669;\n                }\n\n                .exit-popup-benefits {\n                    list-style: none;\n                    padding: 0;\n                    margin: 0 0 30px;\n                    text-align: left;\n                    display: inline-block;\n                }\n\n                .exit-popup-benefits li {\n                    padding: 8px 0;\n                    font-size: 15px;\n                    color: #4b5563;\n                    display: flex;\n                    align-items: center;\n                    gap: 10px;\n                }\n\n                .exit-popup-benefits i {\n                    color: #10b981;\n                    font-size: 14px;\n                }\n\n                .exit-popup-form {\n                    margin-bottom: 20px;\n                }\n\n                .exit-popup-input {\n                    width: 100%;\n                    padding: 14px 18px;\n                    border: 2px solid #e5e7eb;\n                    border-radius: 10px;\n                    font-size: 16px;\n                    margin-bottom: 12px;\n                    transition: all 0.2s;\n                }\n\n                .exit-popup-input:focus {\n                    outline: none;\n                    border-color: #4F46E5;\n                    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);\n                }\n\n                .exit-popup-submit {\n                    width: 100%;\n                    padding: 16px 24px;\n                    background: linear-gradient(135deg, #4F46E5, #6366F1);\n                    color: white;\n                    border: none;\n                    border-radius: 10px;\n                    font-size: 18px;\n                    font-weight: 700;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 10px;\n                }\n\n                .exit-popup-submit:hover {\n                    transform: translateY(-2px);\n                    box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);\n                }\n\n                .exit-popup-disclaimer {\n                    font-size: 13px;\n                    color: #6b7280;\n                    margin: 0 0 15px;\n                }\n\n                .exit-popup-urgency {\n                    display: inline-flex;\n                    align-items: center;\n                    gap: 8px;\n                    padding: 8px 16px;\n                    background: #fee2e2;\n                    border-radius: 8px;\n                    color: #dc2626;\n                    font-size: 14px;\n                    font-weight: 600;\n                }\n\n                @media (max-width: 480px) {\n                    .exit-popup-content {\n                        padding: 30px 20px;\n                    }\n\n                    .exit-popup-title {\n                        font-size: 24px;\n                    }\n\n                    .value-amount {\n                        font-size: 28px;\n                    }\n\n                    .exit-popup-benefits {\n                        font-size: 14px;\n                    }\n                }\n            </style>\n        "),document.body.insertAdjacentHTML("beforeend",'\n            <div id="exit-intent-overlay" class="exit-popup-overlay" style="display: none;">\n                <div class="exit-popup-container">\n                    <button class="exit-popup-close" aria-label="Close popup">\n                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <line x1="18" y1="6" x2="6" y2="18"></line>\n                            <line x1="6" y1="6" x2="18" y2="18"></line>\n                        </svg>\n                    </button>\n\n                    <div class="exit-popup-content">\n                        <div class="exit-popup-badge">\n                            <span>LIMITED TIME OFFER</span>\n                        </div>\n\n                        <h2 class="exit-popup-title">\n                            Wait! Don\'t Leave Empty-Handed\n                        </h2>\n\n                        <div class="exit-popup-value">\n                            <span class="value-amount">$997</span>\n                            <span class="value-label">VALUE</span>\n                        </div>\n\n                        <h3 class="exit-popup-subtitle">\n                            Get Your FREE Digital Marketing Audit\n                        </h3>\n\n                        <ul class="exit-popup-benefits">\n                            <li><i class="fas fa-check"></i> Comprehensive SEO Analysis</li>\n                            <li><i class="fas fa-check"></i> Google Ads Account Review</li>\n                            <li><i class="fas fa-check"></i> Competitor Benchmarking Report</li>\n                            <li><i class="fas fa-check"></i> Custom Growth Strategy Roadmap</li>\n                            <li><i class="fas fa-check"></i> 30-Minute Strategy Call Included</li>\n                        </ul>\n\n                        <form id="exit-popup-form" class="exit-popup-form" action="https://formspree.io/f/meoqjgzn" method="POST">\n                            <input type="hidden" name="source" value="exit_intent_popup">\n                            <input type="hidden" name="offer" value="free_audit">\n\n                            <div class="form-group">\n                                <input\n                                    type="text"\n                                    name="name"\n                                    placeholder="Your Name"\n                                    required\n                                    class="exit-popup-input"\n                                >\n                            </div>\n\n                            <div class="form-group">\n                                <input\n                                    type="email"\n                                    name="email"\n                                    placeholder="Your Email"\n                                    required\n                                    class="exit-popup-input"\n                                >\n                            </div>\n\n                            <div class="form-group">\n                                <input\n                                    type="tel"\n                                    name="phone"\n                                    placeholder="Your Phone (Optional)"\n                                    class="exit-popup-input"\n                                >\n                            </div>\n\n                            <button type="submit" class="exit-popup-submit">\n                                Get My Free Audit Now\n                                <i class="fas fa-arrow-right"></i>\n                            </button>\n                        </form>\n\n                        <p class="exit-popup-disclaimer">\n                            ðŸ”’ Your information is 100% secure. No spam, ever.\n                        </p>\n\n                        <div class="exit-popup-urgency">\n                            <i class="fas fa-clock"></i>\n                            <span>Offer expires in <span id="countdown-timer">10:00</span></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ')}attachEventListeners(){const n=document.getElementById("exit-intent-overlay"),e=document.querySelector(".exit-popup-close"),t=document.getElementById("exit-popup-form");this.isMobile()?this.setupMobileTriggers():document.addEventListener("mouseout",(n=>{n.clientY<=0&&this.canShowPopup()&&this.showPopup()})),e.addEventListener("click",(()=>{this.closePopup(),this.trackEvent("closed")})),n.addEventListener("click",(e=>{e.target===n&&(this.closePopup(),this.trackEvent("closed_overlay"))})),t.addEventListener("submit",(async n=>{n.preventDefault(),await this.handleFormSubmission(t)})),this.startCountdown()}setupMobileTriggers(){setTimeout((()=>{this.canShowPopup()&&this.showPopup()}),this.config.mobileDelay);let n=!1;window.addEventListener("scroll",(()=>{if(!n&&this.canShowPopup()){window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100>this.config.scrollThreshold&&(n=!0,this.showPopup())}})),window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",(()=>{this.canShowPopup()&&(this.showPopup(),window.history.pushState(null,"",window.location.href))}))}trackPageTime(){this.pageLoadTime=Date.now()}canShowPopup(){const n=document.getElementById("exit-intent-overlay"),e=Date.now()-this.pageLoadTime;return"none"===n.style.display&&e>=this.config.minTimeOnPage&&!this.getCookie(this.config.cookieName)}showPopup(){const n=document.getElementById("exit-intent-overlay");n.style.display="flex",this.setCookie(this.config.cookieName,"true",this.config.cookieExpiry),this.trackEvent("shown"),this.analytics.shown++;const e=n.querySelector('input[name="name"]');e&&setTimeout((()=>e.focus()),100)}closePopup(){document.getElementById("exit-intent-overlay").style.display="none",this.analytics.closed++}async handleFormSubmission(n){const e=n.querySelector(".exit-popup-submit"),t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Submitting...',e.disabled=!0;const i=new FormData(n);try{if(!(await fetch(n.action,{method:"POST",body:i,headers:{Accept:"application/json"}})).ok)throw new Error("Submission failed");this.analytics.converted++,this.trackEvent("converted");document.querySelector(".exit-popup-content").innerHTML='\n                    <div style="padding: 40px 20px;">\n                        <div style="font-size: 48px; color: #10b981; margin-bottom: 20px;">\n                            <i class="fas fa-check-circle"></i>\n                        </div>\n                        <h2 style="font-size: 28px; font-weight: 800; margin: 0 0 15px; color: #111827;">\n                            Success! Check Your Email\n                        </h2>\n                        <p style="font-size: 16px; color: #6b7280; margin: 0 0 25px;">\n                            Your free audit is on its way. We\'ll be in touch within 1 business hour.\n                        </p>\n                        <button onclick="document.getElementById(\'exit-intent-overlay\').style.display=\'none\'"\n                                style="padding: 12px 30px; background: linear-gradient(135deg, #4F46E5, #6366F1); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">\n                            Continue Browsing\n                        </button>\n                    </div>\n                ',setTimeout((()=>this.closePopup()),5e3)}catch(i){console.error("Form submission error:",i),e.innerHTML=t,e.disabled=!1;const o=document.createElement("p");o.style.color="#dc2626",o.style.fontSize="14px",o.style.marginTop="10px",o.textContent="Something went wrong. Please try again or call us directly.",n.appendChild(o)}}startCountdown(){let n=600;const e=document.getElementById("countdown-timer");if(!e)return;const t=()=>{const i=Math.floor(n/60),o=n%60;e.textContent=`${i}:${o.toString().padStart(2,"0")}`,n>0?(n--,setTimeout(t,1e3)):e.textContent="Expired"};t()}trackEvent(n){"undefined"!=typeof gtag&&gtag("event","exit_intent_"+n,{event_category:"engagement",event_label:window.location.pathname}),"undefined"!=typeof fbq&&"converted"===n&&fbq("track","Lead",{content_name:"Exit Intent Popup",value:997,currency:"AUD"}),console.log(`Exit Intent: ${n}`,this.analytics)}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768}setCookie(n,e,t){const i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3),document.cookie=`${n}=${e};expires=${i.toUTCString()};path=/`}getCookie(n){const e=n+"=",t=document.cookie.split(";");for(let n=0;n<t.length;n++){let i=t[n].trim();if(0===i.indexOf(e))return i.substring(e.length)}return null}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{new ExitIntentPopup})):new ExitIntentPopup;