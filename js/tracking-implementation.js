class TrackingImplementation{constructor(){this.config={ga4:{id:"G-FB947JWCFT",enabled:!0},facebook:{pixelId:"XXXXXXXXXX",enabled:!0},hotjar:{hjid:"6526316",hjsv:6,enabled:!0},clarity:{projectId:"XXXXXXXXXX",enabled:!1},googleAds:{conversionId:"AW-XXXXXXXXX",enabled:!0}},this.init()}init(){this.loadGA4(),this.loadFacebookPixel(),this.loadHotjar(),this.loadGoogleAdsConversion(),this.config.clarity.enabled&&this.loadClarity(),window.addEventListener("load",(()=>{this.setupEventTracking(),this.setupEcommerceTracking(),this.setupCustomDimensions()}))}loadGA4(){if(!this.config.ga4.enabled)return;const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${this.config.ga4.id}`,document.head.appendChild(e),window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config",this.config.ga4.id,{page_path:window.location.pathname,debug_mode:"localhost"===window.location.hostname}),gtag("config",this.config.ga4.id,{"custom_map.dimension1":"user_type","custom_map.dimension2":"page_category","custom_map.dimension3":"form_type"}),console.log("GA4 tracking initialized")}loadFacebookPixel(){if(!this.config.facebook.enabled)return;var e,t,n,o,a,i;e=window,t=document,n="script",e.fbq||(o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],(a=t.createElement(n)).async=!0,a.src="https://connect.facebook.net/en_US/fbevents.js",(i=t.getElementsByTagName(n)[0]).parentNode.insertBefore(a,i)),fbq("init",this.config.facebook.pixelId),fbq("track","PageView");const c=this.getPageCategory();"other"!==c&&fbq("track","ViewContent",{content_category:c,content_type:"page"}),console.log("Facebook Pixel initialized")}loadHotjar(){this.config.hotjar.enabled&&(!function(e,t,n,o,a,i){e.hj=e.hj||function(){(e.hj.q=e.hj.q||[]).push(arguments)},e._hjSettings={hjid:this.config.hotjar.hjid,hjsv:this.config.hotjar.hjsv},a=t.getElementsByTagName("head")[0],(i=t.createElement("script")).async=1,i.src="https://static.hotjar.com/c/hotjar-"+e._hjSettings.hjid+".js?sv="+e._hjSettings.hjsv,a.appendChild(i)}(window,document),console.log("Hotjar initialized"))}loadClarity(){var e,t,n,o,a,i,c;this.config.clarity.enabled&&(e=window,t=document,n="clarity",o="script",a=this.config.clarity.projectId,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},(i=t.createElement(o)).async=1,i.src="https://www.clarity.ms/tag/"+a,(c=t.getElementsByTagName(o)[0]).parentNode.insertBefore(i,c),console.log("Microsoft Clarity initialized"))}loadGoogleAdsConversion(){this.config.googleAds.enabled&&(window.gtag=window.gtag||function(){dataLayer.push(arguments)},document.addEventListener("tpp_form_submit",(e=>{gtag("event","conversion",{send_to:`${this.config.googleAds.conversionId}/XXXXXXXXX`,value:e.detail.value||1e3,currency:"AUD"})})))}setupEventTracking(){document.querySelectorAll('a[href^="tel:"]').forEach((e=>{e.addEventListener("click",(()=>{this.trackEvent("contact","phone_click",e.href.replace("tel:","")),"undefined"!=typeof fbq&&fbq("track","Contact",{contact_type:"phone"})}))})),document.querySelectorAll('a[href^="mailto:"]').forEach((e=>{e.addEventListener("click",(()=>{this.trackEvent("contact","email_click",e.href.replace("mailto:","")),"undefined"!=typeof fbq&&fbq("track","Contact",{contact_type:"email"})}))})),document.querySelectorAll('.btn-primary, .cta-button, [class*="action"]').forEach((e=>{e.addEventListener("click",(()=>{const t=e.textContent.trim();this.trackEvent("engagement","cta_click",t)}))})),this.trackFormInteractions(),this.trackScrollDepth(),this.trackTimeOnPage(),this.trackExternalLinks()}trackFormInteractions(){document.querySelectorAll("form").forEach((e=>{let t=!1;const n=e.id||"unnamed_form";e.addEventListener("focusin",(()=>{t||(t=!0,this.trackEvent("form","form_start",n),"undefined"!=typeof fbq&&fbq("track","InitiateCheckout",{content_name:n}))})),e.addEventListener("submit",(t=>{const o=new FormData(e),a=Object.fromEntries(o),i=this.calculateLeadValue(a);this.trackEvent("conversion","form_submit",n,i),"undefined"!=typeof fbq&&fbq("track","Lead",{value:i,currency:"AUD",content_name:n}),"undefined"!=typeof gtag&&gtag("event","conversion",{send_to:`${this.config.googleAds.conversionId}/form_submit`,value:i,currency:"AUD"}),document.dispatchEvent(new CustomEvent("tpp_form_submit",{detail:{formName:n,data:a,value:i}}))}));let o=e.querySelectorAll("input, textarea, select"),a=new Set;o.forEach((e=>{e.addEventListener("blur",(()=>{e.value.trim()&&a.add(e.name)}))})),window.addEventListener("beforeunload",(()=>{a.size>0&&!e.dataset.submitted&&this.trackEvent("form","form_abandon",n,a.size)}))}))}trackScrollDepth(){let e=0;const t=[25,50,75,90,100],n=new Set;window.addEventListener("scroll",(()=>{const o=Math.round(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100);o>e&&(e=o,t.forEach((e=>{o>=e&&!n.has(e)&&(n.add(e),this.trackEvent("engagement","scroll_depth",`${e}%`))})))})),window.addEventListener("beforeunload",(()=>{this.trackEvent("engagement","max_scroll_depth",`${e}%`)}))}trackTimeOnPage(){const e=Date.now(),t=[10,30,60,120,300],n=new Set,o=()=>{const a=Math.round((Date.now()-e)/1e3);t.forEach((e=>{a>=e&&!n.has(e)&&(n.add(e),this.trackEvent("engagement","time_on_page",`${e}s`))})),n.size<t.length&&setTimeout(o,5e3)};setTimeout(o,5e3),window.addEventListener("beforeunload",(()=>{const t=Math.round((Date.now()-e)/1e3);this.trackEvent("engagement","total_time_on_page",`${t}s`)}))}trackExternalLinks(){document.querySelectorAll('a[href^="http"]:not([href*="'+window.location.hostname+'"])').forEach((e=>{e.addEventListener("click",(()=>{this.trackEvent("outbound","click",e.href)}))}))}setupEcommerceTracking(){const e=this.getServiceFromPage();e&&(this.trackEvent("ecommerce","view_item",e.name,e.value),"undefined"!=typeof fbq&&fbq("track","ViewContent",{content_name:e.name,content_category:"service",value:e.value,currency:"AUD"}))}setupCustomDimensions(){const e=this.getUserType();"undefined"!=typeof gtag&&gtag("config",this.config.ga4.id,{user_type:e,page_category:this.getPageCategory()})}trackEvent(e,t,n=null,o=null){if("undefined"!=typeof gtag){const a={event_category:e,event_label:n};null!==o&&(a.value=o),gtag("event",t,a)}"undefined"!=typeof hj&&hj("event",`${e}_${t}`),console.log("Event tracked:",{category:e,action:t,label:n,value:o})}calculateLeadValue(e){return{"$1000-$2000":1500,"$2000-$3000":2500,"$3000-$5000":4e3,"$5000+":7500}[e.budget]||2e3}getPageCategory(){const e=window.location.pathname;return e.includes("seo")?"seo":e.includes("google-ads")?"google-ads":e.includes("web-design")?"web-design":e.includes("contact")?"contact":"/"===e||e.includes("index")?"home":"other"}getServiceFromPage(){const e=window.location.pathname,t={seo:{name:"SEO Services",value:2e3},"google-ads":{name:"Google Ads Management",value:1500},"web-design":{name:"Web Design",value:3e3}};for(const[n,o]of Object.entries(t))if(e.includes(n))return o;return null}getUserType(){if(document.cookie.includes("returning_visitor=true"))return"returning";document.cookie="returning_visitor=true; max-age=2592000; path=/";const e=document.referrer;return e.includes("google")?"organic_search":e.includes("facebook")||e.includes("instagram")?"social":e.includes("linkedin")?"professional":e?"referral":"direct"}}const tracking=new TrackingImplementation;window.TPPTracking=tracking;