class ComponentLibrary{constructor(){this.components=new Map,this.cache=new Map,this.loadQueue=[],this.isProcessing=!1,this.registerComponents(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.initialize())):this.initialize()}registerComponents(){this.register("footer",{path:"/components/layout/footer.html",selector:'footer[role="contentinfo"], [data-component="footer"]',replace:!0,initialize:e=>this.initFooter(e)}),this.register("service-card",{path:"/components/sections/service-card.html",selector:'[data-component="service-card"]',template:!0,initialize:(e,t)=>this.initServiceCard(e,t)}),this.register("testimonial",{path:"/components/sections/testimonial.html",selector:'[data-component="testimonial"]',template:!0,initialize:(e,t)=>this.initTestimonial(e,t)}),this.register("pricing-card",{path:"/components/sections/pricing-card.html",selector:'[data-component="pricing-card"]',template:!0,initialize:(e,t)=>this.initPricingCard(e,t)}),this.register("cta-section",{path:"/components/sections/cta.html",selector:'[data-component="cta-section"]',template:!0,initialize:(e,t)=>this.initCTA(e,t)}),this.register("contact-form",{path:"/components/forms/contact.html",selector:'[data-component="contact-form"]',replace:!0,initialize:e=>this.initContactForm(e)})}register(e,t){this.components.set(e,{name:e,...t,loaded:!1,instances:[]})}async initialize(){console.log("ðŸŽ¨ Component Library initializing...");for(const[e,t]of this.components){const n=document.querySelectorAll(t.selector);if(n.length>0){console.log(`Found ${n.length} ${e} component(s)`);for(const t of n)await this.loadComponent(e,t)}}await this.processQueue(),console.log("âœ… Component Library initialized"),document.dispatchEvent(new CustomEvent("components:ready",{detail:{components:Array.from(this.components.keys())}}))}async loadComponent(e,t){const n=this.components.get(e);if(n)try{let o=this.cache.get(n.path);if(!o){const e=await fetch(n.path);if(!e.ok)throw new Error(`HTTP ${e.status}`);o=await e.text(),this.cache.set(n.path,o)}if(n.template&&t.dataset&&(o=this.processTemplate(o,t.dataset)),n.replace){const e=document.createElement("div");e.innerHTML=o;const n=e.firstElementChild;n&&(t.parentNode.replaceChild(n,t),t=n)}else t.innerHTML=o;n.initialize&&n.initialize(t,t.dataset),n.instances.push(t),n.loaded=!0,t.dispatchEvent(new CustomEvent("component:loaded",{detail:{name:e,element:t},bubbles:!0})),console.log(`âœ… Loaded ${e} component`)}catch(n){console.error(`Failed to load ${e} component:`,n),this.loadQueue.push({name:e,element:t})}else console.error(`Component "${e}" not registered`)}processTemplate(e,t){let n=e;for(const[e,o]of Object.entries(t)){const t=new RegExp(`{{${e}}}`,"g");n=n.replace(t,o)}return n}async processQueue(){if(!this.isProcessing&&0!==this.loadQueue.length){for(this.isProcessing=!0;this.loadQueue.length>0;){const{name:e,element:t}=this.loadQueue.shift();await this.loadComponent(e,t)}this.isProcessing=!1}}initFooter(e){e.querySelectorAll(".social-icon").forEach((e=>{e.addEventListener("click",(()=>{if(window.TPPTracking){const t=e.getAttribute("aria-label");window.TPPTracking.trackEvent("social","click",t)}}))}));const t=e.querySelector(".newsletter-form");t&&t.addEventListener("submit",(e=>{e.preventDefault();const n=t.querySelector('input[type="email"]').value;console.log("Newsletter signup:",n),t.innerHTML='<p style="color: #10b981;">Thank you for subscribing!</p>'}))}initServiceCard(e,t){e.addEventListener("mouseenter",(()=>{e.style.transform="translateY(-5px)"})),e.addEventListener("mouseleave",(()=>{e.style.transform="translateY(0)"}));e.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(()=>{window.TPPTracking&&window.TPPTracking.trackEvent("service","click",t.service||"unknown")}))}))}initTestimonial(e,t){const n=e.querySelector(".testimonial-rating");if(n&&t.rating){const e=parseInt(t.rating);let o="";for(let t=0;t<5;t++)o+=t<e?"â˜…":"â˜†";n.textContent=o}const o=e.querySelector("img[data-src]");if(o&&"IntersectionObserver"in window){const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(o.src=o.dataset.src,o.removeAttribute("data-src"),e.unobserve(o))}))}));e.observe(o)}}initPricingCard(e,t){if("true"===t.featured){const t=document.createElement("div");t.className="pricing-badge",t.textContent="Most Popular",e.prepend(t)}const n=e.querySelector(".btn-primary, .cta-button");n&&n.addEventListener("click",(()=>{window.TPPTracking&&window.TPPTracking.trackEvent("pricing","cta_click",t.plan||"unknown")}))}initCTA(e,t){if("true"===t.urgency){const t=document.createElement("p");t.className="cta-urgency",t.innerHTML="âš¡ Limited time offer - Act now!",e.querySelector(".cta-content")?.appendChild(t)}e.addEventListener("click",(e=>{e.target.matches("a, button")&&window.TPPTracking&&window.TPPTracking.trackEvent("cta","click",t.campaign||"general")}))}initContactForm(e){if(window.EmailNotificationHandler){const t=new EmailNotificationHandler;e.querySelector("form")&&t.attachToForms()}const t=e.querySelector("form");t&&t.addEventListener("submit",(e=>{const n=t.querySelector('input[type="email"]'),o=t.querySelector('input[type="tel"]');return n&&!n.value.includes("@")?(e.preventDefault(),void alert("Please enter a valid email address")):o&&o.value.length<10?(e.preventDefault(),void alert("Please enter a valid phone number")):void 0}))}reload(e){const t=this.components.get(e);t&&(this.cache.delete(t.path),t.instances.forEach((t=>{this.loadComponent(e,t)})))}clearCache(){this.cache.clear(),console.log("Component cache cleared")}getStats(){const e={registered:this.components.size,loaded:Array.from(this.components.values()).filter((e=>e.loaded)).length,cached:this.cache.size,instances:0};for(const t of this.components.values())e.instances+=t.instances.length;return e}}window.ComponentLibrary=new ComponentLibrary,window.loadComponent=async(e,t)=>{const n=document.querySelector(t);if(n)return await window.ComponentLibrary.loadComponent(e,n)},console.log("ðŸ“š Component Library loaded");