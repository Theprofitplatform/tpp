---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => {
    return !data.draft;
  });

  return posts.map(post => {
    // Strip date prefix from slug (YYYY-MM-DD-)
    const cleanSlug = post.slug.replace(/^\d{4}-\d{2}-\d{2}-/, '');

    // Get related posts (same category or tags, excluding current post)
    const relatedPosts = posts
      .filter(p => p.slug !== post.slug && !p.data.draft)
      .filter(p =>
        p.data.category === post.data.category ||
        post.data.tags?.some(tag => p.data.tags?.includes(tag))
      )
      .slice(0, 3);

    return {
      params: { slug: cleanSlug },
      props: { post, relatedPosts },
    };
  });
}

const { post, relatedPosts } = Astro.props;
const { Content } = await post.render();

// Strip date prefix from slug for clean URLs
const cleanSlug = post.slug.replace(/^\d{4}-\d{2}-\d{2}-/, '');

// Handle both pubDate and publishDate for backwards compatibility
const publishDate = post.data.publishDate || post.data.pubDate || new Date();

// Calculate reading time (avg 200 words per minute)
const wordCount = post.body.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

// Author profiles for schema and bio
const authorProfiles = {
  "Avi": {
    name: "Avi",
    jobTitle: "Founder & SEO Strategist",
    bio: "Avi is the founder of The Profit Platform with over 10 years of experience in digital marketing and SEO. He's helped hundreds of Australian businesses achieve first-page Google rankings and sustainable growth.",
    email: "avi@theprofitplatform.com.au",
    url: "https://theprofitplatform.com.au/about",
    sameAs: [
      "https://www.linkedin.com/company/theprofitplatform",
      "https://twitter.com/profitplatform"
    ]
  },
  "TPP Team": {
    name: "The Profit Platform Team",
    jobTitle: "Digital Marketing Experts",
    bio: "Our team of digital marketing specialists brings together expertise in SEO, Google Ads, content marketing, and web design. We're passionate about helping Australian businesses grow through data-driven strategies.",
    email: "team@theprofitplatform.com.au",
    url: "https://theprofitplatform.com.au/about",
    sameAs: [
      "https://www.linkedin.com/company/theprofitplatform",
      "https://twitter.com/profitplatform"
    ]
  },
  "The Profit Platform": {
    name: "The Profit Platform",
    jobTitle: "Digital Marketing Agency",
    bio: "We're a digital marketing agency specializing in scalable SEO and growth strategies for Australian businesses. Based in Sydney, we've helped hundreds of companies dominate local search results.",
    email: "info@theprofitplatform.com.au",
    url: "https://theprofitplatform.com.au/about",
    sameAs: [
      "https://www.linkedin.com/company/theprofitplatform",
      "https://www.facebook.com/theprofitplatform",
      "https://www.instagram.com/theprofitplatform"
    ]
  }
};

const currentAuthor = authorProfiles[post.data.author] || authorProfiles["The Profit Platform"];

const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.description,
  "image": post.data.coverImage ? {
    "@type": "ImageObject",
    "url": post.data.coverImage,
    "width": 1200,
    "height": 630
  } : undefined,
  "datePublished": publishDate.toISOString(),
  "dateModified": post.data.updatedDate ? post.data.updatedDate.toISOString() : publishDate.toISOString(),
  "author": {
    "@type": "Person",
    "name": currentAuthor.name,
    "jobTitle": currentAuthor.jobTitle,
    "email": currentAuthor.email,
    "url": currentAuthor.url,
    "sameAs": currentAuthor.sameAs
  },
  "publisher": {
    "@type": "Organization",
    "name": "The Profit Platform",
    "logo": {
      "@type": "ImageObject",
      "url": "https://theprofitplatform.com.au/logo.png"
    },
    "url": "https://theprofitplatform.com.au"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://theprofitplatform.com.au/blog/${cleanSlug}/`
  },
  "wordCount": wordCount,
  "articleSection": post.data.category,
  "keywords": post.data.tags ? post.data.tags.join(', ') : undefined,
  "inLanguage": "en-AU",
  "isAccessibleForFree": true,
  "timeRequired": `PT${readingTime}M`
};
---

<BaseLayout
  title={post.data.seo?.title || post.data.title}
  description={post.data.seo?.description || post.data.description}
>
  <Header />

  <script type="application/ld+json" set:html={JSON.stringify(schema)} />

  <!-- Reading Progress Bar -->
  <div class="reading-progress">
    <div class="reading-progress-bar"></div>
  </div>

  <article class="blog-post">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <div class="container-narrow">
        <ol itemscope itemtype="https://schema.org/BreadcrumbList">
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/"><span itemprop="name">Home</span></a>
            <meta itemprop="position" content="1" />
          </li>
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/blog"><span itemprop="name">Blog</span></a>
            <meta itemprop="position" content="2" />
          </li>
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name">{post.data.title}</span>
            <meta itemprop="position" content="3" />
          </li>
        </ol>
      </div>
    </nav>

    <header class="post-header">
      <div class="container-narrow">
        <!-- Category Badge -->
        <div class="post-meta-top">
          <span class="category-badge">{post.data.category}</span>
        </div>

        <!-- Title -->
        <h1 class="post-title">{post.data.title}</h1>

        <!-- Description -->
        <p class="post-lead">{post.data.description}</p>

        <!-- Author & Meta -->
        <div class="post-meta">
          <div class="author-info">
            <div class="author-avatar">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
              </svg>
            </div>
            <div class="author-details">
              <span class="author-name">{post.data.author}</span>
              <div class="meta-items">
                <time datetime={publishDate.toISOString()}>
                  {publishDate.toLocaleDateString('en-AU', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  })}
                </time>
                <span class="meta-separator">â€¢</span>
                <span class="reading-time">{readingTime} min read</span>
                <span class="meta-separator">â€¢</span>
                <span class="word-count">{wordCount.toLocaleString()} words</span>
              </div>
            </div>
          </div>

          <!-- Share Buttons -->
          <div class="share-buttons">
            <button class="share-btn" data-share="twitter" aria-label="Share on Twitter">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
            </button>
            <button class="share-btn" data-share="linkedin" aria-label="Share on LinkedIn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/>
              </svg>
            </button>
            <button class="share-btn" data-share="facebook" aria-label="Share on Facebook">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.34 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96A10 10 0 0 0 22 12.06C22 6.53 17.5 2.04 12 2.04Z"/>
              </svg>
            </button>
            <button class="share-btn" data-share="copy" aria-label="Copy link">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Tags -->
        {post.data.tags && post.data.tags.length > 0 && (
          <div class="post-tags">
            {post.data.tags.map(tag => (
              <a href={`/blog?tag=${encodeURIComponent(tag)}`} class="tag">#{tag}</a>
            ))}
          </div>
        )}
      </div>
    </header>

    <!-- Featured Image or Default Hero -->
    <div class="featured-image-container">
      {post.data.coverImage ? (
        <figure class="featured-image">
          <img
            src={post.data.coverImage}
            alt={post.data.coverImageAlt || post.data.title}
            loading="eager"
            fetchpriority="high"
            width="1200"
            height="630"
          />
          {post.data.coverImageCredit && (
            <figcaption class="image-credit">
              Photo by <a
                href={post.data.coverImageCredit.link + '?utm_source=theprofitplatform&utm_medium=referral'}
                target="_blank"
                rel="noopener noreferrer"
              >
                {post.data.coverImageCredit.name}
              </a> on <a
                href="https://unsplash.com?utm_source=theprofitplatform&utm_medium=referral"
                target="_blank"
                rel="noopener noreferrer"
              >
                Unsplash
              </a>
            </figcaption>
          )}
        </figure>
      ) : (
        <figure class="featured-image default-hero">
          <svg viewBox="0 0 1200 400" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="heroGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#5568d3;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#6941a8;stop-opacity:1" />
              </linearGradient>
            </defs>

            <!-- Background -->
            <rect width="1200" height="400" fill="url(#heroGradient)"/>

            <!-- Decorative circles -->
            <circle cx="100" cy="80" r="60" fill="white" opacity="0.1"/>
            <circle cx="1100" cy="320" r="80" fill="white" opacity="0.08"/>
            <circle cx="200" cy="350" r="40" fill="white" opacity="0.12"/>

            <!-- Main illustration - Laptop -->
            <g transform="translate(350, 80)">
              <!-- Laptop screen -->
              <rect x="0" y="0" width="500" height="300" rx="12" fill="white" opacity="0.95"/>
              <rect x="0" y="0" width="500" height="250" rx="12" fill="#1f2937"/>
              <rect x="20" y="20" width="460" height="210" rx="6" fill="white"/>

              <!-- Content lines -->
              <rect x="40" y="40" width="120" height="12" rx="6" fill="#5568d3"/>
              <rect x="40" y="70" width="350" height="8" rx="4" fill="#e5e7eb"/>
              <rect x="40" y="90" width="380" height="8" rx="4" fill="#e5e7eb"/>
              <rect x="40" y="110" width="320" height="8" rx="4" fill="#e5e7eb"/>
              <rect x="40" y="140" width="200" height="8" rx="4" fill="#e5e7eb"/>
              <rect x="40" y="160" width="280" height="8" rx="4" fill="#e5e7eb"/>

              <!-- Decorative elements on screen -->
              <circle cx="420" cy="50" r="8" fill="#6941a8"/>
              <circle cx="450" cy="60" r="6" fill="#5568d3" opacity="0.6"/>

              <!-- Laptop base -->
              <path d="M-20 300 L-10 310 L510 310 L520 300 Z" fill="white" opacity="0.9"/>
            </g>

            <!-- Floating icons -->
            <g transform="translate(150, 150)">
              <circle cx="0" cy="0" r="30" fill="white" opacity="0.25"/>
              <path d="M-10 -5 L-10 5 M-5 0 L5 0" stroke="#5568d3" stroke-width="3" stroke-linecap="round"/>
            </g>

            <g transform="translate(950, 180)">
              <rect x="-20" y="-20" width="40" height="40" rx="6" fill="white" opacity="0.2"/>
              <path d="M-8 -2 L-2 4 L8 -6" stroke="#5568d3" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </g>
          </svg>
        </figure>
      )}
    </div>

    <div class="container">
      <!-- Table of Contents (will be populated by JavaScript) -->
      <aside class="table-of-contents" id="toc-container" style="display: none;">
        <h3 class="toc-title">Table of Contents</h3>
        <nav id="toc-nav"></nav>
      </aside>

      <div class="post-content">
        <Content />
      </div>

      <div class="post-footer">
        {post.data.updatedDate && (
          <p>Last updated: {post.data.updatedDate.toLocaleDateString('en-AU')}</p>
        )}
      </div>

      <!-- Author Bio -->
      <aside class="author-bio-card">
        <div class="author-bio-avatar">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
          </svg>
        </div>
        <div class="author-bio-content">
          <h4>About {currentAuthor.name}</h4>
          <p class="author-job-title">{currentAuthor.jobTitle}</p>
          <p>{currentAuthor.bio}</p>
          <a href={currentAuthor.url} class="author-bio-link">Learn more â†’</a>
        </div>
      </aside>

      <aside class="post-cta">
        <h3>Ready to grow your business?</h3>
        <p>Let's talk about how we can help you achieve results like these.</p>
        <a href="/contact" class="cta-button">Schedule a Free Consultation</a>
      </aside>

      <!-- Comments Section -->
      <section class="comments-section">
        <h3 class="comments-title">Comments & Discussion</h3>
        <p class="comments-intro">Share your thoughts or ask questions about this article. Sign in with GitHub to comment.</p>
        <div id="giscus-container">
          <script
            src="https://giscus.app/client.js"
            data-repo="theprofitplatform/blog-comments"
            data-repo-id="REPLACE_WITH_YOUR_REPO_ID"
            data-category="General"
            data-category-id="REPLACE_WITH_YOUR_CATEGORY_ID"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="light"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
          </script>
        </div>
        <noscript>
          <p style="color: #64748b; text-align: center; padding: 2rem;">
            Please enable JavaScript to view comments.
          </p>
        </noscript>
      </section>
    </div>

    <!-- Related Posts -->
    {relatedPosts && relatedPosts.length > 0 && (
      <section class="related-posts">
        <div class="container">
          <h3 class="related-posts-title">Continue Reading</h3>
          <div class="related-posts-grid">
            {relatedPosts.map((relatedPost) => {
              const relatedPublishDate = relatedPost.data.publishDate || relatedPost.data.pubDate || new Date();
              return (
                <article class="related-post-card">
                  <a href={`/blog/${relatedPost.slug.replace(/^\d{4}-\d{2}-\d{2}-/, '')}`} class="related-post-link">
                    <div class="related-post-category">{relatedPost.data.category}</div>
                    <h4 class="related-post-title">{relatedPost.data.title}</h4>
                    <p class="related-post-excerpt">{relatedPost.data.description}</p>
                    <div class="related-post-meta">
                      <time datetime={relatedPublishDate.toISOString()}>
                        {relatedPublishDate.toLocaleDateString('en-AU', { month: 'short', day: 'numeric', year: 'numeric' })}
                      </time>
                    </div>
                  </a>
                </article>
              );
            })}
          </div>
        </div>
      </section>
    )}
  </article>
</BaseLayout>

<style>
  /* Reading Progress Bar */
  .reading-progress {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: #e2e8f0;
    z-index: 1;
  }

  .reading-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    width: 0%;
    transition: width 0.1s ease-out;
  }

  /* Breadcrumbs */
  .breadcrumbs {
    background: #f8f9fa;
    padding: 1rem 0;
    margin-top: 95px;
    border-bottom: 1px solid #e9ecef;
  }

  .breadcrumbs ol {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
    margin: 0;
    padding: 0;
  }

  .breadcrumbs li {
    display: flex;
    align-items: center;
    font-size: 0.875rem;
    color: #6c757d;
  }

  .breadcrumbs li:not(:last-child)::after {
    content: 'â€º';
    margin-left: 0.5rem;
    color: #adb5bd;
    font-weight: 600;
  }

  .breadcrumbs a {
    color: #667eea;
    text-decoration: none;
    transition: color 0.2s;
  }

  .breadcrumbs a:hover {
    color: #5568d3;
    text-decoration: underline;
  }

  .breadcrumbs li:last-child span {
    color: #495057;
    font-weight: 500;
  }

  /* Container */
  .container-narrow {
    max-width: 750px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  /* Post Header */
  .post-header {
    position: relative;
    background: #ffffff;
    color: #0f172a;
    padding: 3.5rem 0 2.5rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .post-meta-top {
    margin-bottom: 1.5rem;
  }

  .category-badge {
    display: inline-block;
    background: #ede9fe;
    color: #6d28d9;
    border: 1px solid #ddd6fe;
    padding: 0.4rem 1rem;
    border-radius: 50px;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 1px;
    font-size: 0.75rem;
  }

  .post-title {
    font-size: clamp(2.25rem, 5vw, 3.25rem);
    margin: 1.5rem 0 1rem;
    line-height: 1.2;
    font-weight: 800;
    letter-spacing: -0.02em;
    color: #0f172a;
  }

  .post-lead {
    font-size: clamp(1.125rem, 2vw, 1.25rem);
    line-height: 1.6;
    color: #475569;
    margin-bottom: 2rem;
    font-weight: 400;
  }

  /* Author & Meta */
  .post-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1.5rem;
    padding: 1.5rem 0;
    border-top: 1px solid #e2e8f0;
    border-bottom: 1px solid #e2e8f0;
  }

  .author-info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .author-avatar {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    background: #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #e2e8f0;
  }

  .author-avatar svg {
    width: 28px;
    height: 28px;
    color: #64748b;
  }

  .author-details {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .author-name {
    font-weight: 600;
    font-size: 1rem;
    color: #0f172a;
  }

  .meta-items {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: #64748b;
  }

  .meta-separator {
    opacity: 0.5;
  }

  /* Share Buttons */
  .share-buttons {
    display: flex;
    gap: 0.75rem;
  }

  .share-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #64748b;
  }

  .share-btn svg {
    width: 18px;
    height: 18px;
  }

  .share-btn:hover {
    background: #667eea;
    border-color: #667eea;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }

  /* Tags */
  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .post-tags .tag {
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    color: #475569;
    transition: all 0.3s;
  }

  .post-tags .tag:hover {
    background: #e2e8f0;
    color: #0f172a;
    transform: translateY(-1px);
  }

  /* Featured Image */
  .featured-image-container {
    background: #f8f9fa;
    padding: 3rem 0 2rem;
    margin: 0;
  }

  .featured-image {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .featured-image img {
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    display: block;
  }

  .featured-image.default-hero {
    padding: 0;
    max-width: 100%;
  }

  .featured-image.default-hero svg {
    width: 100%;
    height: auto;
    display: block;
    max-height: 400px;
  }

  .image-credit {
    text-align: center;
    font-size: 0.8125rem;
    color: #6c757d;
    margin-top: 1rem;
    font-style: italic;
  }

  .image-credit a {
    color: #667eea;
    text-decoration: none;
    transition: color 0.2s;
  }

  .image-credit a:hover {
    color: #5568d3;
    text-decoration: underline;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  /* Table of Contents */
  .table-of-contents {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 2rem 0;
  }

  .toc-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 1rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .toc-title::before {
    content: 'ðŸ“‘';
    font-size: 1.25rem;
  }

  #toc-nav {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #toc-nav a {
    display: block;
    color: #64748b;
    text-decoration: none;
    padding: 0.5rem 0;
    font-size: 0.9375rem;
    line-height: 1.4;
    border-left: 2px solid transparent;
    padding-left: 0.75rem;
    transition: all 0.2s;
  }

  #toc-nav a:hover {
    color: #667eea;
    border-left-color: #667eea;
  }

  #toc-nav a.active {
    color: #667eea;
    font-weight: 600;
    border-left-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
  }

  #toc-nav .toc-h3 {
    padding-left: 1.5rem;
    font-size: 0.875rem;
  }

  .post-content {
    line-height: 1.75;
    font-size: 1.1875rem;
    color: #334155;
  }

  /* Hide duplicate H1 from markdown content */
  .post-content :global(h1:first-child) {
    display: none;
  }

  .post-content :global(h2) {
    font-size: 2rem;
    margin-top: 3rem;
    margin-bottom: 1.25rem;
    color: #0f172a;
    font-weight: 700;
    line-height: 1.3;
    letter-spacing: -0.01em;
  }

  .post-content :global(h3) {
    font-size: 1.5rem;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: #1e293b;
    font-weight: 600;
    line-height: 1.4;
  }

  .post-content :global(p) {
    margin: 1.5rem 0;
  }

  .post-content :global(ul),
  .post-content :global(ol) {
    margin: 1.5rem 0;
    padding-left: 2rem;
  }

  .post-content :global(li) {
    margin: 0.75rem 0;
  }

  .post-content :global(code) {
    background: #f4f4f4;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
  }

  .post-content :global(pre) {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 1.5rem;
    border-radius: 6px;
    overflow-x: auto;
    margin: 2rem 0;
  }

  .post-content :global(blockquote) {
    border-left: 4px solid #667eea;
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: #666;
  }

  /* Pull Quote / Stat Highlight */
  .post-content :global(.stat-highlight) {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-left: 4px solid #667eea;
    border-radius: 8px;
    padding: 2rem;
    margin: 2.5rem 0;
    text-align: center;
  }

  .post-content :global(.stat-number) {
    font-size: 3rem;
    font-weight: 800;
    color: #667eea;
    line-height: 1;
    margin-bottom: 0.5rem;
  }

  .post-content :global(.stat-label) {
    font-size: 1.125rem;
    color: #475569;
    font-weight: 500;
  }

  /* Step Headers with Numbers */
  .post-content :global(.step-header) {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-top: 3rem;
    margin-bottom: 1.25rem;
  }

  .post-content :global(.step-number) {
    font-size: 3.5rem;
    font-weight: 800;
    color: #667eea;
    opacity: 0.2;
    line-height: 1;
    min-width: 70px;
  }

  .post-content :global(.step-header h2) {
    margin: 0;
    flex: 1;
  }

  /* Results Box */
  .post-content :global(.results-box) {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border: 2px solid #86efac;
    border-radius: 12px;
    padding: 2rem;
    margin: 2.5rem 0;
  }

  .post-content :global(.results-box h2),
  .post-content :global(.results-box h3) {
    color: #15803d;
    margin-top: 0;
  }

  .post-content :global(.results-box ul) {
    margin-bottom: 0;
  }

  .post-content :global(.results-box li) {
    color: #166534;
  }

  .post-content :global(.results-box strong) {
    color: #15803d;
  }

  .post-footer {
    max-width: 750px;
    margin: 2rem auto 0;
    padding-top: 2rem;
    border-top: 1px solid #e9ecef;
    color: #64748b;
    font-size: 0.9375rem;
  }

  /* Author Bio Card */
  .author-bio-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 2rem;
    margin: 2.5rem auto;
    max-width: 750px;
    display: flex;
    gap: 1.5rem;
    align-items: start;
  }

  .author-bio-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .author-bio-avatar svg {
    width: 40px;
    height: 40px;
    color: white;
  }

  .author-bio-content h4 {
    margin: 0 0 0.75rem 0;
    color: #0f172a;
    font-size: 1.25rem;
    font-weight: 700;
  }

  .author-bio-content p {
    margin: 0 0 1rem 0;
    color: #475569;
    line-height: 1.6;
  }

  .author-bio-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9375rem;
    transition: color 0.2s;
  }

  .author-bio-link:hover {
    color: #5568d3;
    text-decoration: underline;
  }

  .post-cta {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    margin: 3rem auto;
    max-width: 750px;
    box-shadow: 0 20px 60px rgba(102, 126, 234, 0.25);
  }

  .post-cta h3 {
    margin-bottom: 0.75rem;
    color: white;
    font-size: 1.75rem;
    font-weight: 700;
  }

  .post-cta p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.125rem;
    margin-bottom: 1.5rem;
  }

  .cta-button {
    display: inline-block;
    background: white;
    color: #667eea;
    padding: 1rem 2.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1.0625rem;
    margin-top: 0.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .cta-button:hover {
    background: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }

  /* Comments Section */
  .comments-section {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 2.5rem;
    margin: 3rem auto;
    max-width: 750px;
  }

  .comments-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 0.5rem 0;
  }

  .comments-intro {
    color: #64748b;
    font-size: 1rem;
    margin: 0 0 2rem 0;
    line-height: 1.6;
  }

  #giscus-container {
    margin-top: 1.5rem;
  }

  /* Related Posts */
  .related-posts {
    background: #f8fafc;
    padding: 4rem 0;
    margin-top: 3rem;
    border-top: 1px solid #e2e8f0;
  }

  .related-posts-title {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 3rem;
  }

  .related-posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .related-post-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .related-post-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
    border-color: #667eea;
  }

  .related-post-link {
    display: block;
    padding: 1.75rem;
    text-decoration: none;
    color: inherit;
  }

  .related-post-category {
    display: inline-block;
    background: #ede9fe;
    color: #6d28d9;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 0.375rem 0.75rem;
    border-radius: 50px;
    margin-bottom: 1rem;
  }

  .related-post-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 0.75rem 0;
    line-height: 1.4;
  }

  .related-post-excerpt {
    font-size: 0.9375rem;
    color: #64748b;
    line-height: 1.6;
    margin: 0 0 1rem 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .related-post-meta {
    font-size: 0.875rem;
    color: #94a3b8;
  }

  .related-post-card:hover .related-post-title {
    color: #667eea;
  }

  /* Mobile */
  @media (max-width: 768px) {
    .container-narrow {
      padding: 0 1.25rem;
    }

    .breadcrumbs {
      padding: 0.75rem 0;
    }

    .breadcrumbs li {
      font-size: 0.8125rem;
    }

    .post-header {
      padding: 2.5rem 0;
    }

    .post-title {
      margin: 1rem 0 0.75rem;
    }

    .post-meta {
      flex-direction: column;
      align-items: flex-start;
    }

    .share-buttons {
      width: 100%;
      justify-content: flex-start;
    }

    .post-tags {
      margin-top: 1rem;
    }

    .post-content {
      font-size: 1.125rem;
      line-height: 1.7;
    }

    .post-content :global(h2) {
      font-size: 1.75rem;
      margin-top: 2.5rem;
    }

    .post-content :global(h3) {
      font-size: 1.375rem;
      margin-top: 2rem;
    }

    .share-btn {
      width: 44px;
      height: 44px;
    }

    .featured-image-container {
      padding: 2rem 0 1.5rem;
    }

    .featured-image {
      padding: 0 1.25rem;
    }

    .featured-image img {
      border-radius: 8px;
    }

    .author-bio-card {
      flex-direction: column;
      text-align: center;
      align-items: center;
      padding: 1.5rem;
    }

    .author-bio-avatar {
      width: 72px;
      height: 72px;
    }

    .author-bio-avatar svg {
      width: 36px;
      height: 36px;
    }

    .post-cta {
      padding: 2rem 1.5rem;
    }

    .post-cta h3 {
      font-size: 1.5rem;
    }

    .cta-button {
      width: 100%;
      max-width: 320px;
    }

    .related-posts {
      padding: 3rem 0;
    }

    .related-posts-title {
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }

    .related-posts-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>

<script>
  // Reading progress bar
  const updateReadingProgress = () => {
    const progressBar = document.querySelector('.reading-progress-bar');
    if (!progressBar) return;

    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    const scrollTop = window.scrollY;
    const trackLength = documentHeight - windowHeight;
    const percentScrolled = (scrollTop / trackLength) * 100;

    progressBar.style.width = `${Math.min(percentScrolled, 100)}%`;
  };

  window.addEventListener('scroll', updateReadingProgress, { passive: true });
  window.addEventListener('resize', updateReadingProgress, { passive: true });
  updateReadingProgress();

  // Add lazy loading to all images in post content
  document.addEventListener('DOMContentLoaded', () => {
    const contentImages = document.querySelectorAll('.post-content img');
    contentImages.forEach(img => {
      if (!img.hasAttribute('loading')) {
        img.setAttribute('loading', 'lazy');
      }
    });
  });

  // Track page views for popular posts
  document.addEventListener('DOMContentLoaded', () => {
    const slug = window.location.pathname.split('/').filter(Boolean).pop();
    if (slug) {
      const viewCounts = JSON.parse(localStorage.getItem('blogViewCounts') || '{}');
      viewCounts[slug] = (viewCounts[slug] || 0) + 1;
      localStorage.setItem('blogViewCounts', JSON.stringify(viewCounts));
    }
  });

  // Generate Table of Contents
  document.addEventListener('DOMContentLoaded', () => {
    const postContent = document.querySelector('.post-content');
    const tocContainer = document.getElementById('toc-container');
    const tocNav = document.getElementById('toc-nav');

    if (!postContent || !tocContainer || !tocNav) return;

    const headings = postContent.querySelectorAll('h2, h3');

    if (headings.length < 3) {
      // Don't show TOC if there are fewer than 3 headings
      return;
    }

    // Generate TOC
    const tocList = document.createElement('ul');
    tocList.style.listStyle = 'none';
    tocList.style.padding = '0';
    tocList.style.margin = '0';

    headings.forEach((heading, index) => {
      const id = `heading-${index}`;
      heading.id = id;

      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${id}`;
      a.textContent = heading.textContent;
      a.className = heading.tagName === 'H3' ? 'toc-h3' : '';

      a.addEventListener('click', (e) => {
        e.preventDefault();
        heading.scrollIntoView({ behavior: 'smooth', block: 'start' });

        // Update active state
        tocList.querySelectorAll('a').forEach(link => link.classList.remove('active'));
        a.classList.add('active');

        // Update URL hash
        history.pushState(null, null, `#${id}`);
      });

      li.appendChild(a);
      tocList.appendChild(li);
    });

    tocNav.appendChild(tocList);
    tocContainer.style.display = 'block';

    // Highlight active section on scroll
    const observerOptions = {
      rootMargin: '-100px 0px -80% 0px',
      threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.id;
          tocList.querySelectorAll('a').forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === `#${id}`);
          });
        }
      });
    }, observerOptions);

    headings.forEach(heading => observer.observe(heading));
  });

  // Social sharing functionality
  document.addEventListener('DOMContentLoaded', () => {
    const shareButtons = document.querySelectorAll('.share-btn');
    const postTitle = document.querySelector('.post-title')?.textContent || '';
    const postURL = window.location.href;

    shareButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const platform = btn.getAttribute('data-share');

        switch(platform) {
          case 'twitter':
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(postTitle)}&url=${encodeURIComponent(postURL)}`, '_blank', 'width=550,height=420');
            break;

          case 'linkedin':
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(postURL)}`, '_blank', 'width=550,height=420');
            break;

          case 'facebook':
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(postURL)}`, '_blank', 'width=550,height=420');
            break;

          case 'copy':
            navigator.clipboard.writeText(postURL).then(() => {
              const originalHTML = btn.innerHTML;
              btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
              btn.style.background = 'rgba(76, 175, 80, 0.3)';

              setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.style.background = '';
              }, 2000);
            });
            break;
        }
      });
    });
  });
</script>
