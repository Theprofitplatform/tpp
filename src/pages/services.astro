---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import NavigationSection from '../components/sections/NavigationSection.astro';
import FooterSection from '../components/sections/FooterSection.astro';
import PageHero from '../components/sections/PageHero.astro';
import CTASection from '../components/sections/CTASection.astro';

const pageTitle = "Services | The Profit Platform";
const pageDescription = "Comprehensive digital marketing solutions for Sydney businesses. SEO, Google Ads, web design, and content marketing services to grow your business.";

// Get all services from collection
const allServices = await getCollection('services', ({ data }) => {
  return !data.draft;
});

// Sort services - featured first, then by publish date
const services = allServices.sort((a, b) => {
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return b.data.publishDate.getTime() - a.data.publishDate.getTime();
});
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <NavigationSection />

  <main id="main-content" role="main" class="min-h-screen">
    <PageHero
      title="Our Services"
      subtitle="Comprehensive digital marketing solutions tailored to your business goals"
    />

    <!-- Services Grid -->
    <section class="py-20 md:py-32">
      <div class="container mx-auto px-4">
        <div class="max-w-7xl mx-auto">
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {services.map((service) => (
              <a href={`/services/${service.slug}`} class="group">
                <div class="bg-white border border-gray-200 rounded-2xl p-8 hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 h-full flex flex-col">
                  {service.data.icon && (
                    <div class="text-5xl mb-4 group-hover:scale-110 transition-transform duration-300">
                      {service.data.icon}
                    </div>
                  )}

                  {service.data.featured && (
                    <span class="inline-block bg-indigo-100 text-indigo-600 text-xs font-semibold px-3 py-1 rounded-full mb-3 w-fit">
                      FEATURED
                    </span>
                  )}

                  <h3 class="text-2xl font-bold mb-3 group-hover:text-indigo-600 transition-colors">
                    {service.data.title}
                  </h3>

                  <p class="text-gray-600 mb-4 flex-grow">
                    {service.data.description}
                  </p>

                  {service.data.price && (
                    <p class="text-sm font-semibold text-indigo-600 mb-2">
                      {service.data.price}
                    </p>
                  )}

                  {service.data.tags.length > 0 && (
                    <div class="flex flex-wrap gap-2 mt-4">
                      {service.data.tags.slice(0, 3).map((tag) => (
                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}

                  <div class="mt-6 flex items-center text-indigo-600 font-semibold group-hover:translate-x-2 transition-transform">
                    Learn More →
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </div>
    </section>

    <CTASection
      title="Ready to Transform Your Digital Presence?"
      subtitle="Get a free consultation and custom strategy for your business"
      buttonText="Book Your Free Consultation"
    />
  </main>

  <FooterSection />

  <!-- Structured Data - Service Schema -->
  <script type="application/ld+json" is:inline>
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Service",
        "serviceType": "Search Engine Optimization (SEO)",
        "provider": {
          "@type": "LocalBusiness",
          "@id": "https://theprofitplatform.com.au/#organization",
          "name": "The Profit Platform"
        },
        "areaServed": {
          "@type": "City",
          "name": "Sydney"
        },
        "description": "Dominate search results and attract high-quality organic traffic. Our proven SEO strategies help Sydney businesses rank higher and generate more leads.",
        "offers": {
          "@type": "Offer",
          "availability": "https://schema.org/InStock"
        }
      },
      {
        "@type": "Service",
        "serviceType": "Google Ads Management",
        "provider": {
          "@type": "LocalBusiness",
          "@id": "https://theprofitplatform.com.au/#organization"
        },
        "areaServed": {
          "@type": "City",
          "name": "Sydney"
        },
        "description": "Get immediate visibility and qualified leads with expertly managed Google Ads campaigns that maximize your ROI.",
        "offers": {
          "@type": "Offer",
          "availability": "https://schema.org/InStock"
        }
      },
      {
        "@type": "Service",
        "serviceType": "Website Design & Development",
        "provider": {
          "@type": "LocalBusiness",
          "@id": "https://theprofitplatform.com.au/#organization"
        },
        "areaServed": {
          "@type": "City",
          "name": "Sydney"
        },
        "description": "Beautiful, high-converting websites built on modern technology. Your website is your digital storefront – make it count.",
        "offers": {
          "@type": "Offer",
          "availability": "https://schema.org/InStock"
        }
      },
      {
        "@type": "Service",
        "serviceType": "Content Marketing",
        "provider": {
          "@type": "LocalBusiness",
          "@id": "https://theprofitplatform.com.au/#organization"
        },
        "areaServed": {
          "@type": "City",
          "name": "Sydney"
        },
        "description": "Attract, engage, and convert your ideal customers with strategic content marketing that drives results.",
        "offers": {
          "@type": "Offer",
          "availability": "https://schema.org/InStock"
        }
      }
    ]
  }
  </script>
</BaseLayout>