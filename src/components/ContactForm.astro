---
interface Props {
  variant?: 'default' | 'inline';
}

const { variant = 'default' } = Astro.props;
---

<form
  id="contact-form"
  class="space-y-6"
  data-variant={variant}
  action={import.meta.env.PUBLIC_N8N_WEBHOOK || 'https://n8n.theprofitplatform.com.au/webhook/contact'}
  method="POST"
>
  <!-- Honeypot for spam protection -->
  <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off">

  <!-- FormSubmit configuration -->
  <input type="hidden" name="_subject" value="New contact form submission">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_template" value="table">

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <label for="name" class="form-label-modern">
        Full Name <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="form-input-modern"
        placeholder="John Smith"
      />
    </div>

    <div>
      <label for="email" class="form-label-modern">
        Email Address <span class="text-red-500">*</span>
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="form-input-modern"
        placeholder="john@company.com"
      />
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <label for="phone" class="form-label-modern">
        Phone Number
      </label>
      <input
        type="tel"
        id="phone"
        name="phone"
        class="form-input-modern"
        placeholder="0400 000 000"
      />
    </div>

    <div>
      <label for="company" class="form-label-modern">
        Company Name
      </label>
      <input
        type="text"
        id="company"
        name="company"
        class="form-input-modern"
        placeholder="Your Company Pty Ltd"
      />
    </div>
  </div>

  <div>
    <label for="service" class="form-label-modern">
      Service Interested In <span class="text-red-500">*</span>
    </label>
    <select
      id="service"
      name="service"
      required
      class="form-select-modern"
    >
      <option value="">Select a service...</option>
      <option value="Digital Marketing">Digital Marketing Strategy</option>
      <option value="SEO">Search Engine Optimization</option>
      <option value="Web Design">Web Design & Development</option>
      <option value="Google Ads">Google Ads Management</option>
      <option value="Social Media">Social Media Marketing</option>
      <option value="Content Marketing">Content Marketing</option>
      <option value="Other">Other / Not Sure</option>
    </select>
  </div>

  <div>
    <label for="budget" class="form-label-modern">
      Monthly Budget Range
    </label>
    <select
      id="budget"
      name="budget"
      class="form-select-modern"
    >
      <option value="">Select budget range...</option>
      <option value="Under $2000">Under $2,000/month</option>
      <option value="$2000-$5000">$2,000 - $5,000/month</option>
      <option value="$5000-$10000">$5,000 - $10,000/month</option>
      <option value="$10000+">$10,000+/month</option>
      <option value="Not sure">Not sure yet</option>
    </select>
  </div>

  <div>
    <label for="message" class="form-label-modern">
      Tell Us About Your Project <span class="text-red-500">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      required
      rows="6"
      class="form-textarea-modern"
      placeholder="Please describe your business, goals, and what you're hoping to achieve..."
    ></textarea>
  </div>

  <div class="flex items-start gap-3">
    <input
      type="checkbox"
      id="consent"
      name="consent"
      required
      class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-600"
    />
    <label for="consent" class="text-sm text-gray-600">
      I agree to receive communications from The Profit Platform and understand that I can unsubscribe at any time. By submitting this form, I agree to the <a href="/privacy" class="text-blue-600 hover:text-blue-700 underline">Privacy Policy</a>.
    </label>
  </div>

  <div>
    <button
      type="submit"
      class="form-submit-button-modern"
      id="submit-btn"
    >
      <span id="submit-text">Send Message</span>
      <span id="submit-loading" class="hidden">Sending...</span>
      <div class="submit-button-glow"></div>
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div id="form-message" class="hidden p-4 rounded-lg" role="alert"></div>
</form>

<style>
  .form-label-modern {
    display: block;
    font-size: 0.875rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.625rem;
    letter-spacing: 0.3px;
  }

  .form-input-modern,
  .form-select-modern,
  .form-textarea-modern {
    width: 100%;
    padding: 0.875rem 1.125rem;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 1rem;
    color: #1e293b;
    background: white;
    transition: all 0.3s ease;
  }

  .form-input-modern:focus,
  .form-select-modern:focus,
  .form-textarea-modern:focus {
    outline: none;
    border-color: #3B82F6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .form-input-modern::placeholder,
  .form-textarea-modern::placeholder {
    color: #94a3b8;
  }

  .form-select-modern {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 1.5rem 1.5rem;
    padding-right: 3rem;
  }

  .form-textarea-modern {
    resize: vertical;
    min-height: 150px;
  }

  .form-submit-button-modern {
    position: relative;
    width: 100%;
    background: linear-gradient(135deg, #3B82F6, #2c86f9);
    color: white;
    font-weight: 700;
    font-size: 1.125rem;
    padding: 1rem 2rem;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
  }

  .form-submit-button-modern:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
  }

  .form-submit-button-modern:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .submit-button-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
    transform: translate(-50%, -50%) scale(0);
    transition: transform 0.5s ease;
    pointer-events: none;
  }

  .form-submit-button-modern:hover:not(:disabled) .submit-button-glow {
    transform: translate(-50%, -50%) scale(2.5);
  }

  @media (max-width: 768px) {
    .form-submit-button-modern {
      padding: 0.875rem 1.5rem;
      font-size: 1rem;
    }
  }
</style>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const submitText = document.getElementById('submit-text') as HTMLElement;
  const submitLoading = document.getElementById('submit-loading') as HTMLElement;
  const formMessage = document.getElementById('form-message') as HTMLElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Disable submit button
    submitBtn.disabled = true;
    submitText.classList.add('hidden');
    submitLoading.classList.remove('hidden');

    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });

      if (response.ok) {
        // Success
        formMessage.textContent = 'Thank you! Your message has been sent successfully. We\'ll get back to you within 24 hours.';
        formMessage.className = 'p-4 rounded-lg bg-green-100 text-green-800 border border-green-200';
        formMessage.classList.remove('hidden');
        form.reset();
      } else {
        throw new Error('Form submission failed');
      }
    } catch (error) {
      // Error
      formMessage.textContent = 'Oops! Something went wrong. Please try again or email us directly at contact@theprofitplatform.com.au';
      formMessage.className = 'p-4 rounded-lg bg-red-100 text-red-800 border border-red-200';
      formMessage.classList.remove('hidden');
    } finally {
      // Re-enable submit button
      submitBtn.disabled = false;
      submitText.classList.remove('hidden');
      submitLoading.classList.add('hidden');
    }
  });
</script>