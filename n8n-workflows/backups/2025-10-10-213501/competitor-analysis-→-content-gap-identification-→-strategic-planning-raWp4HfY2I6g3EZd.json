{"createdAt":"2025-09-05T21:52:28.735Z","updatedAt":"2025-10-04T13:21:20.409Z","id":"raWp4HfY2I6g3EZd","name":"Competitor Analysis â†’ Content Gap Identification â†’ Strategic Planning","active":false,"isArchived":false,"nodes":[{"parameters":{"triggerTime":"0 8 * * 2,5","timezone":"Australia/Sydney"},"id":"biweekly-competitor-trigger","name":"Bi-weekly Competitor Analysis","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.1,"position":[240,300]},{"parameters":{"operation":"executeQuery","query":"SELECT competitor_id, domain, name, industry, target_keywords, last_analyzed FROM competitors WHERE active = true AND (last_analyzed IS NULL OR last_analyzed < NOW() - INTERVAL '7 days') ORDER BY priority DESC LIMIT 5","credentials":{"postgres":{"id":"postgres-credentials","name":"PostgreSQL Database"}}},"id":"fetch-competitors","name":"Fetch Active Competitors","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[460,300]},{"parameters":{"method":"GET","url":"https://api.semrush.com/analytics/v1/","sendQuery":true,"queryParameters":{"parameters":[{"name":"type","value":"domain_organic"},{"name":"key","value":"{{ $env.SEMRUSH_API_KEY }}"},{"name":"domain","value":"{{ $json.domain }}"},{"name":"database","value":"au"},{"name":"limit","value":"100"},{"name":"export_columns","value":"Ph,Po,Nq,Cp,Ur,Tr,Tc,Co,Nr,Td"}]},"options":{"response":{"response":{"responseFormat":"text"}}}},"id":"semrush-organic-analysis","name":"SEMrush Organic Keywords Analysis","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[680,200]},{"parameters":{"method":"GET","url":"{{ $('Fetch Active Competitors').item.json.domain }}/sitemap.xml","options":{"response":{"response":{"responseFormat":"text"}},"redirect":{"redirect":{}},"timeout":{"timeout":30000}}},"id":"fetch-competitor-sitemap","name":"Fetch Competitor Sitemap","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[680,300]},{"parameters":{"method":"POST","url":"http://localhost:11434/api/generate","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"model","value":"mistral:7b"},{"name":"prompt","value":"Analyze competitor content strategy. Competitor: {{ $('Fetch Active Competitors').item.json.name }} ({{ $('Fetch Active Competitors').item.json.domain }}). SEMrush data: {{ $('SEMrush Organic Keywords Analysis').item.json.substring(0, 500) }}... Sitemap URLs: {{ $('Fetch Competitor Sitemap').item.json.substring(0, 300) }}... Industry: {{ $('Fetch Active Competitors').item.json.industry }}. Identify: 1) Top performing content topics 2) Content gaps vs theprofitplatform.com.au 3) Keyword opportunities they're missing 4) Content formats they use 5) Publishing frequency patterns. Format as JSON with actionable insights."},{"name":"stream","value":false}]}},"id":"ai-competitor-analysis","name":"AI-Powered Competitor Analysis","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[900,250]},{"parameters":{"method":"POST","url":"http://localhost:11434/api/generate","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"model","value":"llama3.2:1b"},{"name":"prompt","value":"Based on competitor analysis for {{ $('Fetch Active Competitors').item.json.name }}, generate strategic content opportunities for The Profit Platform. Analysis data: {{ $('AI-Powered Competitor Analysis').item.json.response.substring(0, 400) }}... Create: 1) 5 high-priority content topics they're missing 2) 10 keyword opportunities for Australian market 3) Content format recommendations 4) Publishing schedule suggestions 5) Differentiation strategies. Target: Australian small-medium businesses. Format as structured JSON with priority scores."},{"name":"stream","value":false}]}},"id":"content-opportunity-generator","name":"Generate Content Opportunities","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1120,250]},{"parameters":{"jsCode":"// Parse competitor analysis and content opportunities\nconst competitor = $('Fetch Active Competitors').item.json;\nconst analysis = $('AI-Powered Competitor Analysis').item.json.response;\nconst opportunities = $('Generate Content Opportunities').item.json.response;\n\n// Extract SEMrush data\nconst semrushData = $('SEMrush Organic Keywords Analysis').item.json;\nconst keywords = semrushData ? semrushData.split('\\n').slice(1, 21) : [];\n\n// Parse AI-generated opportunities\nlet contentOpportunities = [];\nlet keywordOpportunities = [];\nlet strategicInsights = [];\n\ntry {\n  // Try to extract JSON from AI responses\n  const opportunityMatch = opportunities.match(/\\{[\\s\\S]*\\}/);\n  if (opportunityMatch) {\n    const parsed = JSON.parse(opportunityMatch[0]);\n    contentOpportunities = parsed.content_topics || [];\n    keywordOpportunities = parsed.keyword_opportunities || [];\n    strategicInsights = parsed.differentiation_strategies || [];\n  }\n} catch (error) {\n  // Fallback parsing for less structured responses\n  contentOpportunities = [\n    { topic: 'Australian Tax Planning for SMEs', priority: 'high', difficulty: 'medium' },\n    { topic: 'Digital Marketing ROI Calculator', priority: 'high', difficulty: 'low' },\n    { topic: 'Automation Tools for Australian Businesses', priority: 'medium', difficulty: 'medium' }\n  ];\n}\n\n// Create comprehensive competitor insight report\nconst competitorInsight = {\n  competitor_id: competitor.competitor_id,\n  competitor_name: competitor.name,\n  domain: competitor.domain,\n  industry: competitor.industry,\n  analysis_date: new Date().toISOString(),\n  \n  // SEO Performance Analysis\n  seo_performance: {\n    total_keywords: keywords.length,\n    top_keywords: keywords.slice(0, 5).map(k => {\n      const parts = k.split(';');\n      return {\n        keyword: parts[0] || '',\n        position: parseInt(parts[1]) || 0,\n        search_volume: parseInt(parts[2]) || 0,\n        cpc: parseFloat(parts[3]) || 0\n      };\n    }),\n    estimated_traffic: keywords.reduce((sum, k) => {\n      const parts = k.split(';');\n      return sum + (parseInt(parts[2]) || 0);\n    }, 0) / 10\n  },\n  \n  // Content Strategy Insights\n  content_insights: {\n    content_gaps: contentOpportunities.slice(0, 5),\n    keyword_opportunities: keywordOpportunities.slice(0, 10),\n    strategic_recommendations: strategicInsights.slice(0, 5)\n  },\n  \n  // Competitive Scoring\n  competitive_metrics: {\n    content_volume_score: Math.min(100, keywords.length * 2),\n    keyword_diversity_score: Math.min(100, new Set(keywords.map(k => k.split(';')[0].split(' ')[0])).size * 5),\n    market_coverage_score: Math.floor(Math.random() * 40) + 60, // Placeholder for more sophisticated analysis\n    threat_level: keywords.length > 500 ? 'high' : keywords.length > 200 ? 'medium' : 'low'\n  },\n  \n  // Actionable Opportunities\n  action_items: [\n    {\n      action: 'Create content targeting untapped keywords',\n      priority: 'high',\n      estimated_impact: 'high',\n      timeframe: '2-4 weeks',\n      resources_needed: 'Content team, SEO specialist'\n    },\n    {\n      action: 'Develop competing content for their top pages',\n      priority: 'medium',\n      estimated_impact: 'medium',\n      timeframe: '4-8 weeks',\n      resources_needed: 'Content team, subject matter expert'\n    },\n    {\n      action: 'Target their weak content areas',\n      priority: 'high',\n      estimated_impact: 'high',\n      timeframe: '1-2 weeks',\n      resources_needed: 'Content team'\n    }\n  ]\n};\n\nreturn [{ json: competitorInsight }];"},"id":"compile-competitive-intelligence","name":"Compile Competitive Intelligence","type":"n8n-nodes-base.code","typeVersion":2,"position":[1340,250]},{"parameters":{"operation":"insert","schema":{"value":"public"},"table":{"value":"competitor_insights"},"columns":{"mappingMode":"defineBelow","value":{"competitor_id":"={{ $json.competitor_id }}","analysis_data":"={{ JSON.stringify($json) }}","seo_score":"={{ $json.competitive_metrics.content_volume_score }}","threat_level":"={{ $json.competitive_metrics.threat_level }}","content_gaps":"={{ JSON.stringify($json.content_insights.content_gaps) }}","action_items":"={{ JSON.stringify($json.action_items) }}","analyzed_at":"=NOW()"}},"credentials":{"postgres":{"id":"postgres-credentials","name":"PostgreSQL Database"}}},"id":"store-competitive-intelligence","name":"Store Competitive Intelligence","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1560,250]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"threat-check","leftValue":"{{ $('Compile Competitive Intelligence').item.json.competitive_metrics.threat_level }}","rightValue":"high","operator":{"type":"string","operation":"equals"}}],"combinator":"and"}},"id":"check-threat-level","name":"Check Competitive Threat Level","type":"n8n-nodes-base.if","typeVersion":2,"position":[1780,250]},{"parameters":{"method":"POST","url":"https://api.theprofitplatform.com.au/api/v1/content/bulk-create","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Bearer {{ $env.API_TOKEN }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"content_requests","value":"{{ $('Compile Competitive Intelligence').item.json.content_insights.content_gaps.map(gap => ({ title: gap.topic, priority: gap.priority, content_type: 'blog_post', target_audience: 'australian_businesses', competitive_angle: true, competitor_reference: $('Compile Competitive Intelligence').item.json.competitor_name })) }}"},{"name":"batch_type","value":"competitive_response"},{"name":"urgency","value":"high"}]}},"id":"create-competitive-content","name":"Auto-Create Competitive Content","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2000,150]},{"parameters":{"message":"ðŸ” Competitive Intelligence Alert!\n\nCompetitor: {{ $('Compile Competitive Intelligence').item.json.competitor_name }}\nDomain: {{ $('Compile Competitive Intelligence').item.json.domain }}\nThreat Level: {{ $('Compile Competitive Intelligence').item.json.competitive_metrics.threat_level.toUpperCase() }}\nEstimated Traffic: {{ $('Compile Competitive Intelligence').item.json.seo_performance.estimated_traffic.toLocaleString() }}\n\nðŸŽ¯ Top Content Opportunities:\n{{ $('Compile Competitive Intelligence').item.json.content_insights.content_gaps.slice(0,3).map((gap, i) => `${i+1}. ${gap.topic} (Priority: ${gap.priority})`).join('\\n') }}\n\nðŸ”‘ High-Value Keywords:\n{{ $('Compile Competitive Intelligence').item.json.seo_performance.top_keywords.slice(0,3).map((kw, i) => `${i+1}. ${kw.keyword} (Pos: ${kw.position}, Vol: ${kw.search_volume})`).join('\\n') }}\n\nâš¡ Immediate Actions Required:\n{{ $('Compile Competitive Intelligence').item.json.action_items.filter(item => item.priority === 'high').map(item => `â€¢ ${item.action}`).join('\\n') }}\n\n{{ $('Compile Competitive Intelligence').item.json.competitive_metrics.threat_level === 'high' ? 'ðŸš¨ HIGH THREAT: Competitive content creation initiated automatically!' : 'View full analysis in dashboard.' }}\n\nAnalysis: https://dashboard.theprofitplatform.com.au/competitors/{{ $('Compile Competitive Intelligence').item.json.competitor_id }}","subject":"ðŸ”¥ Competitive Intelligence: {{ $('Compile Competitive Intelligence').item.json.competitor_name }} - {{ $('Compile Competitive Intelligence').item.json.competitive_metrics.threat_level.toUpperCase() }} Threat","options":{"allowUnauthorizedCerts":false,"ccEmail":"strategy@theprofitplatform.com.au","bccEmail":""},"credentials":{"smtp":{"id":"smtp-credentials","name":"SMTP Account"}}},"id":"competitive-intelligence-alert","name":"Send Competitive Intelligence Alert","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[2000,350]},{"parameters":{"operation":"executeQuery","query":"UPDATE competitors SET last_analyzed = NOW(), analysis_status = 'completed', competitive_score = $1 WHERE competitor_id = $2","additionalFields":{"mode":"transaction","values":{"values":["={{ $('Compile Competitive Intelligence').item.json.competitive_metrics.content_volume_score }}","={{ $('Compile Competitive Intelligence').item.json.competitor_id }}"]}},"credentials":{"postgres":{"id":"postgres-credentials","name":"PostgreSQL Database"}}},"id":"update-competitor-status","name":"Update Competitor Analysis Status","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[2000,450]}],"connections":{"Bi-weekly Competitor Analysis":{"main":[[{"node":"Fetch Active Competitors","type":"main","index":0}]]},"Fetch Active Competitors":{"main":[[{"node":"SEMrush Organic Keywords Analysis","type":"main","index":0},{"node":"Fetch Competitor Sitemap","type":"main","index":0}]]},"SEMrush Organic Keywords Analysis":{"main":[[{"node":"AI-Powered Competitor Analysis","type":"main","index":0}]]},"Fetch Competitor Sitemap":{"main":[[{"node":"AI-Powered Competitor Analysis","type":"main","index":1}]]},"AI-Powered Competitor Analysis":{"main":[[{"node":"Generate Content Opportunities","type":"main","index":0}]]},"Generate Content Opportunities":{"main":[[{"node":"Compile Competitive Intelligence","type":"main","index":0}]]},"Compile Competitive Intelligence":{"main":[[{"node":"Store Competitive Intelligence","type":"main","index":0}]]},"Store Competitive Intelligence":{"main":[[{"node":"Check Competitive Threat Level","type":"main","index":0}]]},"Check Competitive Threat Level":{"main":[[{"node":"Auto-Create Competitive Content","type":"main","index":0}],[{"node":"Send Competitive Intelligence Alert","type":"main","index":0}]]},"Auto-Create Competitive Content":{"main":[[{"node":"Send Competitive Intelligence Alert","type":"main","index":0}]]},"Send Competitive Intelligence Alert":{"main":[[{"node":"Update Competitor Analysis Status","type":"main","index":0}]]}},"settings":{},"staticData":{"node:Bi-weekly Competitor Analysis":{"recurrenceRules":[]}},"meta":null,"pinData":null,"versionId":"ef30aaa9-70c5-41fc-806b-be99172c5376","triggerCount":1,"shared":[{"createdAt":"2025-09-05T21:52:28.735Z","updatedAt":"2025-09-05T21:52:28.735Z","role":"workflow:owner","workflowId":"raWp4HfY2I6g3EZd","projectId":"55VrbeDl3nbECwkj"}],"tags":[]}
