!function(){"use strict";const e={endpoint:"/api/log-error",buffer:[],maxBufferSize:50,init:function(){window.addEventListener("error",(function(t){e.logError({type:"javascript-error",message:t.message,source:t.filename,line:t.lineno,column:t.colno,stack:t.error?t.error.stack:"",userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString()})})),window.addEventListener("unhandledrejection",(function(t){e.logError({type:"unhandled-promise-rejection",message:t.reason?t.reason.toString():"Unknown promise rejection",stack:t.reason&&t.reason.stack?t.reason.stack:"",userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString()})})),window.addEventListener("error",(function(t){t.target!==window&&e.logError({type:"resource-error",tagName:t.target.tagName,source:t.target.src||t.target.href,message:"Failed to load resource",userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString()})}),!0),window.addEventListener("beforeunload",(function(){e.flush()})),setInterval((function(){e.flush()}),3e4)},logError:function(e){this.buffer.push(e),"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||console.error("Logged Error:",e);try{const t=JSON.parse(localStorage.getItem("error_log")||"[]");t.push(e),t.length>100&&t.shift(),localStorage.setItem("error_log",JSON.stringify(t))}catch(e){}this.buffer.length>=this.maxBufferSize&&this.flush()},flush:function(){if(0===this.buffer.length)return;const e=[...this.buffer];this.buffer=[],navigator.sendBeacon?navigator.sendBeacon(this.endpoint,JSON.stringify(e)):fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).catch((function(){try{const t=JSON.parse(localStorage.getItem("error_log_unsent")||"[]");localStorage.setItem("error_log_unsent",JSON.stringify([...t,...e]))}catch(e){}}))}},t={metrics:{},init:function(){window.performance&&window.performance.timing?(this.observeLCP(),this.observeFID(),this.observeCLS(),this.observeTTFB(),this.observeFCP(),window.addEventListener("load",(function(){setTimeout((function(){t.collectNavigationTiming(),t.collectResourceTiming()}),0)})),window.addEventListener("beforeunload",(function(){t.sendMetrics()})),setInterval((function(){t.sendMetrics()}),6e4)):console.warn("Performance API not available")},observeLCP:function(){if("PerformanceObserver"in window)try{new PerformanceObserver((function(e){const n=e.getEntries(),r=n[n.length-1];t.metrics.lcp=r.renderTime||r.loadTime})).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){console.warn("LCP observation failed:",e)}},observeFID:function(){if("PerformanceObserver"in window)try{new PerformanceObserver((function(e){e.getEntries().forEach((function(e){t.metrics.fid=e.processingStart-e.startTime}))})).observe({type:"first-input",buffered:!0})}catch(e){console.warn("FID observation failed:",e)}},observeCLS:function(){if("PerformanceObserver"in window){let e=0,n=[];try{new PerformanceObserver((function(r){for(const o of r.getEntries())if(!o.hadRecentInput){const r=n[0],i=n[n.length-1];i&&r&&o.startTime-i.startTime<1e3&&o.startTime-r.startTime<5e3?(n.push(o),e+=o.value):(n=[o],e=o.value),t.metrics.cls=e}})).observe({type:"layout-shift",buffered:!0})}catch(e){console.warn("CLS observation failed:",e)}}},observeTTFB:function(){if(window.performance&&window.performance.timing){const e=window.performance.timing,t=e.responseStart-e.navigationStart;t>0&&(this.metrics.ttfb=t)}},observeFCP:function(){if("PerformanceObserver"in window)try{new PerformanceObserver((function(e){e.getEntries().forEach((function(e){"first-contentful-paint"===e.name&&(t.metrics.fcp=e.startTime)}))})).observe({type:"paint",buffered:!0})}catch(e){console.warn("FCP observation failed:",e)}},collectNavigationTiming:function(){if(window.performance&&window.performance.timing){const e=window.performance.timing;this.metrics.navigationTiming={domContentLoaded:e.domContentLoadedEventEnd-e.navigationStart,loadComplete:e.loadEventEnd-e.navigationStart,domInteractive:e.domInteractive-e.navigationStart,dnsLookup:e.domainLookupEnd-e.domainLookupStart,tcpConnect:e.connectEnd-e.connectStart,request:e.responseStart-e.requestStart,response:e.responseEnd-e.responseStart,domProcessing:e.domComplete-e.domLoading}}},collectResourceTiming:function(){if(window.performance&&window.performance.getEntriesByType){const e=window.performance.getEntriesByType("resource"),t={count:e.length,totalSize:0,totalDuration:0,slowestResource:null,slowestDuration:0};e.forEach((function(e){const n=e.responseEnd-e.startTime;t.totalDuration+=n,e.transferSize&&(t.totalSize+=e.transferSize),n>t.slowestDuration&&(t.slowestDuration=n,t.slowestResource=e.name)})),this.metrics.resources=t}},sendMetrics:function(){if(0===Object.keys(this.metrics).length)return;const e={metrics:this.metrics,url:window.location.href,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},screen:{width:screen.width,height:screen.height},connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:null,timestamp:(new Date).toISOString()};navigator.sendBeacon?navigator.sendBeacon("/api/performance",JSON.stringify(e)):fetch("/api/performance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).catch((function(){try{const t=JSON.parse(localStorage.getItem("performance_metrics")||"[]");t.push(e),t.length>20&&t.shift(),localStorage.setItem("performance_metrics",JSON.stringify(t))}catch(e){}})),"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||console.log("Performance Metrics:",e)}},n={criticalResources:[{type:"css",url:"/css/critical.min.css"},{type:"css",url:"/css/style.min.css"},{type:"js",url:"/js/main.js"},{type:"font",url:"https://fonts.googleapis.com/css2"},{type:"api",url:"/api/health"}],check:function(){const e={timestamp:(new Date).toISOString(),status:"healthy",checks:[],errors:[]},t=this.criticalResources.map((function(t){return n.checkResource(t).then((function(t){e.checks.push(t),t.success||(e.status="unhealthy",e.errors.push(t))}))}));return Promise.all(t).then((function(){return e}))},checkResource:function(e){const t=performance.now();return"api"===e.type||"css"===e.type||"js"===e.type?fetch(e.url,{method:"HEAD",mode:"no-cors"}).then((function(){return{resource:e.url,type:e.type,success:!0,responseTime:performance.now()-t}})).catch((function(n){return{resource:e.url,type:e.type,success:!1,error:n.message,responseTime:performance.now()-t}})):"font"===e.type?document.fonts.ready.then((function(){return{resource:e.url,type:e.type,success:!0,responseTime:performance.now()-t}})).catch((function(n){return{resource:e.url,type:e.type,success:!1,error:n.message,responseTime:performance.now()-t}})):void 0},runPeriodically:function(){setInterval((function(){n.check().then((function(t){"unhealthy"===t.status&&e.logError({type:"health-check-failure",results:t,timestamp:t.timestamp})}))}),3e5)}};document.addEventListener("DOMContentLoaded",(function(){e.init(),t.init(),n.runPeriodically(),n.check().then((function(e){console.log("Initial Health Check:",e)}))}));var r={metrics:t.metrics,getMetrics:function(){return t.metrics}};window.MonitoringSystem={ErrorLogger:e,PerformanceMonitor:t,HealthCheck:n,WebVitals:r}}();