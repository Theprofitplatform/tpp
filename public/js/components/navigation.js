class NavigationComponent{constructor(e={}){this.config={templatePath:"templates/navigation.html",targetSelector:"body",insertPosition:"afterbegin",autoInit:!0,activePageDetection:!0,smoothTransitions:!0,scrollEffects:!0,accessibilityFeatures:!0,mobileBreakpoint:968,cacheTemplate:!0,...e},this.state={isLoaded:!1,isScrolled:!1,activeDropdown:null,currentPage:this.getCurrentPage(),mobileMenuOpen:!1,template:null},this.elements={container:null,header:null,navLinks:null,dropdowns:null,mobileToggle:null,mobileNav:null,mobileOverlay:null,progressBar:null},this.handlers={scroll:this.throttle(this.handleScroll.bind(this),16),resize:this.throttle(this.handleResize.bind(this),250),click:this.handleClick.bind(this),keydown:this.handleKeydown.bind(this),focusin:this.handleFocusIn.bind(this),focusout:this.handleFocusOut.bind(this)},this.config.autoInit&&this.init()}async init(){try{console.log("Initializing Navigation Component..."),await this.loadTemplate(),await this.injectNavigation(),this.cacheElements(),this.setupEventListeners(),this.setActivePage(),this.initializeFeatures(),this.state.isLoaded=!0,this.dispatchEvent("navigation:loaded"),console.log("Navigation Component initialized successfully")}catch(e){console.error("Failed to initialize navigation:",e),this.dispatchEvent("navigation:error",{error:e})}}async loadTemplate(){if(this.state.template&&this.config.cacheTemplate)return this.state.template;try{const e=await fetch(this.config.templatePath);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return this.state.template=await e.text(),this.state.template}catch(e){throw console.error("Failed to load navigation template:",e),e}}async injectNavigation(){const e=document.querySelector(this.config.targetSelector);if(!e)throw new Error(`Target element "${this.config.targetSelector}" not found`);const t=document.createElement("div");switch(t.className="navigation-component",t.innerHTML=this.state.template,this.config.insertPosition){case"afterbegin":default:e.insertAdjacentElement("afterbegin",t);break;case"beforeend":e.insertAdjacentElement("beforeend",t)}this.elements.container=t}cacheElements(){this.elements.header=document.getElementById("header"),this.elements.navLinks=document.querySelectorAll(".nav-item, .dropdown-item, .mobile-nav-link"),this.elements.dropdowns=document.querySelectorAll(".nav-dropdown"),this.elements.mobileToggle=document.getElementById("menuToggle"),this.elements.mobileNav=document.getElementById("mobileNav"),this.elements.mobileOverlay=document.getElementById("mobileNavOverlay"),this.elements.progressBar=document.getElementById("progressBar")}setupEventListeners(){this.config.scrollEffects&&window.addEventListener("scroll",this.handlers.scroll,{passive:!0}),window.addEventListener("resize",this.handlers.resize),document.addEventListener("click",this.handlers.click),this.config.accessibilityFeatures&&(document.addEventListener("keydown",this.handlers.keydown),document.addEventListener("focusin",this.handlers.focusin),document.addEventListener("focusout",this.handlers.focusout)),document.addEventListener("visibilitychange",(()=>{document.hidden&&this.state.mobileMenuOpen&&this.closeMobileMenu()}))}handleScroll(){const e=window.scrollY,t=e>50;if(t!==this.state.isScrolled&&(this.state.isScrolled=t,this.elements.header&&this.elements.header.classList.toggle("scrolled",t)),this.elements.progressBar){const t=e/(document.documentElement.scrollHeight-window.innerHeight)*100;this.elements.progressBar.style.width=Math.min(t,100)+"%",this.elements.progressBar.parentElement.setAttribute("aria-valuenow",Math.round(t))}this.dispatchEvent("navigation:scroll",{scrollY:e,isScrolled:t})}handleResize(){window.innerWidth>this.config.mobileBreakpoint&&this.state.mobileMenuOpen&&this.closeMobileMenu(),this.dispatchEvent("navigation:resize",{width:window.innerWidth})}handleClick(e){const t=e.target.closest("[data-action]")||e.target;t.closest(".nav-dropdown")&&this.handleDropdownClick(e),t.matches("#menuToggle")&&(e.preventDefault(),this.toggleMobileMenu()),(t.matches("#mobileNavClose")||t.matches("#mobileNavOverlay"))&&(e.preventDefault(),this.closeMobileMenu()),t.matches(".nav-item, .dropdown-item, .mobile-nav-link")&&this.handleNavLinkClick(e,t),!t.closest(".nav-dropdown")&&this.state.activeDropdown&&this.closeDropdown(this.state.activeDropdown)}handleDropdownClick(e){const t=e.target.closest(".nav-dropdown");t.querySelector(".nav-item"),t.querySelector(".dropdown-menu");e.target.closest(".nav-item")&&(e.preventDefault(),this.state.activeDropdown===t?this.closeDropdown(t):(this.state.activeDropdown&&this.closeDropdown(this.state.activeDropdown),this.openDropdown(t)))}openDropdown(e){const t=e.querySelector(".nav-item"),i=e.querySelector(".dropdown-menu");e.classList.add("active"),t.setAttribute("aria-expanded","true"),i.style.display="block",this.config.smoothTransitions&&(i.style.opacity="0",i.style.transform="translateY(-10px)",requestAnimationFrame((()=>{i.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",i.style.opacity="1",i.style.transform="translateY(0)"}))),this.state.activeDropdown=e,this.dispatchEvent("navigation:dropdown:open",{dropdown:e})}closeDropdown(e){const t=e.querySelector(".nav-item"),i=e.querySelector(".dropdown-menu");this.config.smoothTransitions?(i.style.transition="all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout((()=>{e.classList.remove("active"),t.setAttribute("aria-expanded","false"),i.style.display="none",i.style.transition="",i.style.transform=""}),200)):(e.classList.remove("active"),t.setAttribute("aria-expanded","false"),i.style.display="none"),this.state.activeDropdown=null,this.dispatchEvent("navigation:dropdown:close",{dropdown:e})}handleNavLinkClick(e,t){const i=t.getAttribute("href"),n=t.getAttribute("data-page");this.state.mobileMenuOpen&&this.closeMobileMenu(),this.state.activeDropdown&&this.closeDropdown(this.state.activeDropdown),i&&i.startsWith("#")&&(e.preventDefault(),this.smoothScrollTo(i)),this.dispatchEvent("navigation:link:click",{link:t,href:i,page:n})}toggleMobileMenu(){this.state.mobileMenuOpen?this.closeMobileMenu():this.openMobileMenu()}openMobileMenu(){this.state.mobileMenuOpen=!0,this.elements.mobileToggle&&(this.elements.mobileToggle.classList.add("active"),this.elements.mobileToggle.setAttribute("aria-expanded","true")),this.elements.mobileNav&&(this.elements.mobileNav.classList.add("active"),this.elements.mobileNav.setAttribute("aria-hidden","false")),this.elements.mobileOverlay&&this.elements.mobileOverlay.classList.add("active"),document.body.style.overflow="hidden",this.trapFocus(this.elements.mobileNav),this.dispatchEvent("navigation:mobile:open")}closeMobileMenu(){this.state.mobileMenuOpen=!1,this.elements.mobileToggle&&(this.elements.mobileToggle.classList.remove("active"),this.elements.mobileToggle.setAttribute("aria-expanded","false"),this.elements.mobileToggle.focus()),this.elements.mobileNav&&(this.elements.mobileNav.classList.remove("active"),this.elements.mobileNav.setAttribute("aria-hidden","true")),this.elements.mobileOverlay&&this.elements.mobileOverlay.classList.remove("active"),document.body.style.overflow="",this.dispatchEvent("navigation:mobile:close")}handleKeydown(e){switch(e.key){case"Escape":this.state.activeDropdown&&(this.closeDropdown(this.state.activeDropdown),this.state.activeDropdown.querySelector(".nav-item").focus()),this.state.mobileMenuOpen&&this.closeMobileMenu();break;case"ArrowDown":e.target.closest(".nav-dropdown")&&(e.preventDefault(),this.focusNextDropdownItem(e.target));break;case"ArrowUp":e.target.closest(".nav-dropdown")&&(e.preventDefault(),this.focusPrevDropdownItem(e.target));break;case"Tab":this.handleTabNavigation(e)}}handleFocusIn(e){const t=e.target.closest(".nav-dropdown");t&&!this.state.activeDropdown&&this.openDropdown(t)}handleFocusOut(e){setTimeout((()=>{this.state.activeDropdown&&!this.state.activeDropdown.contains(document.activeElement)&&this.closeDropdown(this.state.activeDropdown)}),10)}setActivePage(){if(!this.config.activePageDetection)return;const e=this.getCurrentPage();this.state.currentPage=e,this.elements.navLinks.forEach((e=>{e.classList.remove("active"),e.removeAttribute("aria-current")}));document.querySelectorAll(`[data-page="${e}"], [href="${window.location.pathname}"], [href="${window.location.pathname.split("/").pop()}"]`).forEach((e=>{e.classList.add("active"),e.setAttribute("aria-current","page")})),this.dispatchEvent("navigation:page:set",{currentPage:e})}getCurrentPage(){const e=window.location.pathname.split("/").pop();return e&&"index.html"!==e?e.replace(".html",""):"home"}initializeFeatures(){"IntersectionObserver"in window&&this.setupIntersectionObserver(),this.setupPrefetching(),this.setupKeyboardNavigation()}setupIntersectionObserver(){const e=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?this.elements.header?.classList.add("in-view"):this.elements.header?.classList.remove("in-view")}))}),{threshold:.1});this.elements.header&&e.observe(this.elements.header)}setupPrefetching(){this.elements.navLinks.forEach((e=>{e.addEventListener("mouseenter",(()=>{const t=e.getAttribute("href");t&&t.endsWith(".html")&&!t.startsWith("#")&&this.prefetchPage(t)}))}))}prefetchPage(e){if(document.querySelector(`link[rel="prefetch"][href="${e}"]`))return;const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)}setupKeyboardNavigation(){const e=document.querySelector('a[href="#primary-navigation"]');e&&e.addEventListener("click",(e=>{e.preventDefault();const t=document.getElementById("primary-navigation");t&&(t.focus(),t.scrollIntoView({behavior:"smooth"}))}))}focusNextDropdownItem(e){const t=e.closest(".nav-dropdown").querySelectorAll(".dropdown-item");t[(Array.from(t).indexOf(e)+1)%t.length].focus()}focusPrevDropdownItem(e){const t=e.closest(".nav-dropdown").querySelectorAll(".dropdown-item"),i=Array.from(t).indexOf(e);t[i-1<0?t.length-1:i-1].focus()}trapFocus(e){if(!e)return;const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const i=t[0],n=t[t.length-1];i.focus(),e.addEventListener("keydown",(e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),i.focus()))}))}smoothScrollTo(e){const t=document.querySelector(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}dispatchEvent(e,t={}){const i=new CustomEvent(e,{detail:{...t,navigation:this},bubbles:!0,cancelable:!0});document.dispatchEvent(i)}throttle(e,t){let i;return function(...n){i||(e.apply(this,n),i=!0,setTimeout((()=>i=!1),t))}}destroy(){window.removeEventListener("scroll",this.handlers.scroll),window.removeEventListener("resize",this.handlers.resize),document.removeEventListener("click",this.handlers.click),document.removeEventListener("keydown",this.handlers.keydown),document.removeEventListener("focusin",this.handlers.focusin),document.removeEventListener("focusout",this.handlers.focusout),this.state.mobileMenuOpen&&this.closeMobileMenu(),this.elements.container&&this.elements.container.remove(),this.state={isLoaded:!1,isScrolled:!1,activeDropdown:null,currentPage:null,mobileMenuOpen:!1,template:null},this.dispatchEvent("navigation:destroyed")}updateConfig(e){this.config={...this.config,...e},this.dispatchEvent("navigation:config:updated",{config:this.config})}refresh(){this.setActivePage(),this.cacheElements(),this.dispatchEvent("navigation:refreshed")}}"undefined"!=typeof module&&module.exports&&(module.exports=NavigationComponent),window.NavigationComponent=NavigationComponent;