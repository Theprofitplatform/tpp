import utils from"./shared-utils.js";const{$:$,$$:$$,delegate:delegate,debounce:debounce,throttle:throttle,fetchWithRetry:fetchWithRetry,track:track,ready:ready}=utils;class ComponentLoader{constructor(){this.cache=new Map,this.loadedComponents=new Set,this.componentPath="/components",this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.autoLoadComponents())):this.autoLoadComponents()}async autoLoadComponents(){const o=document.querySelectorAll("[data-component]");for(const t of o){const o=t.dataset.component,e=t.dataset.path||`layout/${o}`;try{await this.loadComponent(e,t)}catch(t){console.error(`Failed to load component ${o}:`,t)}}document.querySelector('footer[role="contentinfo"]')&&await this.replaceFooter()}async loadComponent(o,t){const e=`${this.componentPath}/${o}.html`;if(this.cache.has(e))return t.innerHTML=this.cache.get(e),void this.initializeComponent(o,t);try{const n=await fetch(e);if(!n.ok)throw new Error(`HTTP ${n.status}`);const a=await n.text();return this.cache.set(e,a),t&&(t.innerHTML=a,this.loadedComponents.add(o),this.initializeComponent(o,t)),a}catch(t){throw console.error(`Error loading component ${e}:`,t),o.includes("footer")&&console.log("Using existing footer as fallback"),t}}async replaceFooter(){const o=document.querySelector('footer[role="contentinfo"]');if(o)try{const t=document.createElement("div");t.id="footer-component",t.dataset.component="footer";await this.loadComponent("layout/footer",t);o.parentNode.replaceChild(t,o),console.log("âœ… Footer component loaded successfully"),window.TPPTracking&&window.TPPTracking.trackEvent&&window.TPPTracking.trackEvent("optimization","component_loaded","footer")}catch(o){console.error("Footer component loading failed, keeping original:",o)}}initializeComponent(o,t){switch(o){case"layout/footer":this.initFooterScripts(t);break;case"layout/navigation":this.initNavigationScripts(t);break;case"forms/contact":this.initFormScripts(t)}const e=new CustomEvent("component:loaded",{detail:{name:o,element:t}});document.dispatchEvent(e)}initFooterScripts(o){o.querySelectorAll(".social-icon").forEach((o=>{o.addEventListener("click",(()=>{if(window.TPPTracking){const t=o.getAttribute("aria-label").toLowerCase();window.TPPTracking.trackEvent("social","click",t)}}))}));const t=o.querySelector(".newsletter-form");t&&t.addEventListener("submit",(o=>{o.preventDefault(),console.log("Newsletter subscription")}))}initNavigationScripts(o){const t=o.querySelector(".mobile-menu-toggle");t&&t.addEventListener("click",(()=>{o.querySelector(".nav-menu").classList.toggle("active")}))}initFormScripts(o){o.querySelector("form")&&window.EmailNotificationHandler&&(new EmailNotificationHandler).attachToForms()}async load(o,t){const e=document.querySelector(t);if(e)return await this.loadComponent(o,e)}clearCache(){this.cache.clear(),console.log("Component cache cleared")}getStats(){return{cachedComponents:this.cache.size,loadedComponents:this.loadedComponents.size,cacheSize:Array.from(this.cache.values()).join("").length}}}window.ComponentLoader=new ComponentLoader,window.loadComponent=(o,t)=>window.ComponentLoader.load(o,t),console.log("ðŸ§© Component Loader initialized");export default ComponentLoader;track("module_loaded",{module:"component-loader"});