class EmailNotificationHandler{constructor(){this.formspreeEndpoint="https://formspree.io/f/meoqjgzn",this.notificationEmail="info@theprofitplatform.com.au",this.urgentPhone="1300 123 456",this.init()}init(){document.addEventListener("DOMContentLoaded",(()=>{this.attachToForms(),this.setupUrgencyIndicators(),this.initializeTracking()}))}attachToForms(){document.querySelectorAll('form[action*="formspree"]').forEach((e=>{e.addEventListener("submit",(async t=>{t.preventDefault(),await this.handleFormSubmission(e)}))}))}async handleFormSubmission(e){const t=new FormData(e),i=Object.fromEntries(t);i.timestamp=(new Date).toISOString(),i.page=window.location.pathname,i.referrer=document.referrer,i.device=this.getDeviceType(),i.priority=this.classifyPriority(i);try{if(!(await fetch(e.action,{method:"POST",body:t,headers:{Accept:"application/json"}})).ok)throw new Error("Form submission failed");this.trackConversion(i),this.showSuccessMessage(e),"undefined"!=typeof gtag&&gtag("event","form_submit",{event_category:"engagement",event_label:i.priority,value:this.calculateLeadValue(i)}),"high"===i.priority&&this.sendUrgentNotification(i),setTimeout((()=>e.reset()),2e3)}catch(t){console.error("Primary submission failed:",t),this.handleFailedSubmission(i,e)}}classifyPriority(e){const t=(e.message||"").toLowerCase(),i=["urgent","asap","immediately","today","now"].some((e=>t.includes(e))),n=["enterprise","agency","multiple","team"].some((e=>t.includes(e)));return i||"$5000+"===e.budget?"high":n||"$3000-$5000"===e.budget?"medium":"normal"}calculateLeadValue(e){return{"$1000-$2000":1500,"$2000-$3000":2500,"$3000-$5000":4e3,"$5000+":7500}[e.budget]||1e3}getDeviceType(){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}showSuccessMessage(e){const t=document.createElement("div");t.className="form-success-message",t.innerHTML=`\n            <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 12px; margin-top: 20px; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.2);">\n                <h3 style="margin: 0 0 10px 0; font-size: 1.25rem;">\n                    <i class="fas fa-check-circle"></i> Thank You!\n                </h3>\n                <p style="margin: 0;">We've received your inquiry and will respond within 1 business hour.</p>\n                <p style="margin: 10px 0 0 0; font-size: 0.9rem; opacity: 0.9;">\n                    For urgent matters, call us directly at ${this.urgentPhone}\n                </p>\n            </div>\n        `,e.appendChild(t)}sendUrgentNotification(e){console.log("High-priority lead notification:",e)}handleFailedSubmission(e,t){const i=JSON.parse(localStorage.getItem("failedSubmissions")||"[]");i.push(e),localStorage.setItem("failedSubmissions",JSON.stringify(i));const n=document.createElement("div");n.className="form-fallback-message",n.innerHTML=`\n            <div style="background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; padding: 20px; border-radius: 12px; margin-top: 20px;">\n                <h3 style="margin: 0 0 10px 0;">Temporary Issue</h3>\n                <p>We're experiencing a technical issue. Your information has been saved.</p>\n                <p style="margin-top: 10px;">Please contact us directly:</p>\n                <ul style="margin: 10px 0;">\n                    <li>Phone: <a href="tel:${this.urgentPhone}">${this.urgentPhone}</a></li>\n                    <li>Email: <a href="mailto:${this.notificationEmail}">${this.notificationEmail}</a></li>\n                </ul>\n            </div>\n        `,t.appendChild(n),this.retryFailedSubmissions()}retryFailedSubmissions(){window.addEventListener("online",(()=>{const e=JSON.parse(localStorage.getItem("failedSubmissions")||"[]");e.forEach((async t=>{try{const i=new FormData;Object.keys(t).forEach((e=>i.append(e,t[e]))),await fetch(this.formspreeEndpoint,{method:"POST",body:i,headers:{Accept:"application/json"}});const n=e.filter((e=>e!==t));localStorage.setItem("failedSubmissions",JSON.stringify(n))}catch(e){console.error("Retry failed:",e)}}))}))}setupUrgencyIndicators(){const e=document.querySelector('textarea[name="message"]');e&&e.addEventListener("input",(e=>{["urgent","asap","immediately","today"].some((t=>e.target.value.toLowerCase().includes(t)))&&(e.target.style.borderColor="#ef4444",e.target.style.boxShadow="0 0 0 3px rgba(239, 68, 68, 0.1)")}))}initializeTracking(){document.querySelectorAll("form").forEach((e=>{e.addEventListener("focusin",(()=>{"undefined"!=typeof gtag&&gtag("event","form_start",{event_category:"engagement",event_label:window.location.pathname})}))}))}trackConversion(e){"undefined"!=typeof fbq&&fbq("track","Lead",{value:this.calculateLeadValue(e),currency:"AUD",content_name:"Contact Form",status:e.priority}),"undefined"!=typeof gtag&&gtag("event","conversion",{send_to:"AW-XXXXXXXXX/XXXXXXXXX",value:this.calculateLeadValue(e),currency:"AUD"})}}const emailHandler=new EmailNotificationHandler;"undefined"!=typeof module&&module.exports&&(module.exports=EmailNotificationHandler);